<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Novel Library - Ranobe Gemini</title>
		<link rel="stylesheet" href="library.css" />
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="../icons/logo-32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="../icons/logo-light-32.png"
		/>
	</head>
	<body>
		<div class="library-container">
			<!-- Header -->
			<header class="library-header">
				<div class="header-content">
					<div class="logo-section">
						<img
							src="../icons/logo-light-48.png"
							alt="Ranobe Gemini"
							class="logo light-mode-icon"
						/>
						<!-- <img
							src="../icons/logo-dark-48.png"
							alt="Ranobe Gemini"
							class="logo dark-mode-icon"
						/> -->
						<h1>Novel Library</h1>
					</div>
					<div class="header-actions">
						<div class="search-box">
							<input
								type="text"
								id="search-input"
								placeholder="Search novels..."
							/>
							<span class="search-icon">ğŸ”</span>
						</div>
						<button
							class="btn btn-icon"
							id="refresh-btn"
							title="Refresh Library"
						>
							ğŸ”„
						</button>
						<button
							class="btn btn-icon"
							id="settings-btn"
							title="Library Settings"
						>
							âš™ï¸
						</button>
					</div>
				</div>
			</header>

			<!-- Recent Novels Carousel -->
			<div class="carousel-section" id="carousel-section">
				<div class="carousel-header">
					<h2 class="carousel-title">ğŸ”¥ Recently Read</h2>
				</div>
				<div class="carousel-container">
					<div class="carousel-track" id="carousel-track">
						<!-- Carousel items will be populated by JavaScript -->
					</div>
				</div>
				<div class="carousel-footer">
					<button class="carousel-btn" id="carousel-prev" title="Previous">
						â—€
					</button>
					<div class="carousel-indicators" id="carousel-indicators">
						<!-- Indicators will be populated by JavaScript -->
					</div>
					<button class="carousel-btn" id="carousel-play-pause" title="Pause auto-scroll">
						â¸ï¸
					</button>
					<button class="carousel-btn" id="carousel-next" title="Next">
						â–¶
					</button>
				</div>
			</div>

			<!-- Stats Bar -->
			<div class="stats-bar">
				<div class="stat-item">
					<span class="stat-value" id="total-novels">0</span>
					<span class="stat-label">Novels</span>
				</div>
				<div class="stat-item">
					<span class="stat-value" id="total-chapters">0</span>
					<span class="stat-label">Enhanced Chapters</span>
				</div>
				<div class="stat-item">
					<span class="stat-value" id="shelf-count">0</span>
					<span class="stat-label">Active Websites</span>
				</div>
			</div>

			<!-- View Toggle -->
			<div class="view-controls">
				<div class="view-toggle">
					<button
						class="view-btn active"
						data-view="shelves"
						title="View by Shelves"
					>
						ğŸ“š Shelves
					</button>
					<button
						class="view-btn"
						data-view="recent"
						title="Recent Novels"
					>
						ğŸ• Recent
					</button>
					<button class="view-btn" data-view="all" title="All Novels">
						ğŸ“‹ All
					</button>
					<button class="view-btn" data-view="lists" title="Reading Lists">
						ğŸ“– Lists
					</button>
				</div>
				<div class="sort-controls">
					<label for="sort-select">Sort by:</label>
					<select id="sort-select">
						<option value="recent">Recently Read</option>
						<option value="added">Date Added</option>
						<option value="title">Title (A-Z)</option>
						<option value="chapters">Enhanced Chapters</option>
					</select>
				</div>
			</div>

			<!-- Reading Status Filter (shown in Lists view) -->
			<div id="reading-status-filter" class="reading-status-filter hidden">
				<button class="status-filter-btn active" style="align-items: center;" data-status="all" title="All Novels">
					ğŸ“š All
				</button>
				<button class="status-filter-btn" data-status="reading" title="Currently Reading">
					ğŸ“– Reading
				</button>
				<button class="status-filter-btn" data-status="completed" title="Completed">
					âœ… Completed
				</button>
				<button class="status-filter-btn" data-status="plan-to-read" title="Plan to Read">
					ğŸ“‹ Plan to Read
				</button>
				<button class="status-filter-btn" data-status="on-hold" title="On Hold">
					â¸ï¸ On Hold
				</button>
				<button class="status-filter-btn" data-status="dropped" title="Dropped">
					âŒ Dropped
				</button>
				<button class="status-filter-btn" data-status="re-reading" title="Re-reading">
					ğŸ” Re-reading
				</button>
			</div>

			<!-- Main Content -->
			<main class="library-main">
				<!-- Shelves View -->
				<div id="shelves-view" class="view-content active">
					<!-- Shelves will be populated by JavaScript -->
				</div>

				<!-- Recent View -->
				<div id="recent-view" class="view-content">
					<h2 class="section-title">Recently Read</h2>
					<div id="recent-novels" class="novel-grid">
						<!-- Recent novels will be populated by JavaScript -->
					</div>
				</div>

				<!-- All Novels View -->
				<div id="all-view" class="view-content">
					<h2 class="section-title">All Novels</h2>
					<div id="all-novels" class="novel-grid">
						<!-- All novels will be populated by JavaScript -->
					</div>
				</div>

				<!-- Reading Lists View -->
				<div id="lists-view" class="view-content">
					<h2 class="section-title" id="lists-title">Reading Lists</h2>
					<div id="lists-stats" class="lists-stats">
						<!-- Reading status counts will be shown here -->
					</div>
					<div id="lists-novels" class="novel-grid">
						<!-- Filtered novels will be populated by JavaScript -->
					</div>
				</div>

				<!-- Empty State -->
				<div id="empty-state" class="empty-state hidden">
					<div class="empty-icon">ğŸ“š</div>
					<h2>Your Library is Empty</h2>
					<p>
						Start reading novels on supported sites and they'll
						appear here automatically when you enhance chapters.
					</p>
					<div class="supported-sites">
						<h3>Supported Sites</h3>
						<ul id="supported-sites-list">
							<!-- Dynamically populated from SHELVES -->
						</ul>
					</div>
				</div>

				<!-- Loading State -->
				<div id="loading-state" class="loading-state">
					<div class="spinner"></div>
					<p>Loading your library...</p>
				</div>
			</main>

			<!-- Novel Detail Modal -->
			<div id="novel-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content">
					<button class="modal-close" id="modal-close">
						&times;
					</button>

					<div class="novel-detail">
						<div class="novel-detail-header">
							<img
								id="modal-cover"
								src=""
								alt="Cover"
								class="novel-cover-large"
							/>
							<div class="novel-info">
								<h2 id="modal-title"></h2>
								<p class="novel-author">
									by <span id="modal-author"></span>
								</p>
								<div class="novel-meta">
									<span
										class="meta-badge"
										id="modal-shelf"
									></span>
									<span
										class="meta-badge"
										id="modal-status"
									></span>
									<select
										id="modal-status-selector"
										class="status-selector"
										title="Change Reading Status"
									>
										<!-- Options populated by JavaScript from READING_STATUS_INFO -->
									</select>
								</div>
								<div class="novel-stats">
									<div class="stat">
										<span
											class="stat-num"
											id="modal-chapters"
											>0</span
										>
										<span class="stat-text">Chapters</span>
									</div>
									<div class="stat">
										<span
											class="stat-num"
											id="modal-enhanced"
											>0</span
										>
										<span class="stat-text">Enhanced</span>
									</div>
									<div class="stat">
										<span
											class="stat-num"
											id="modal-last-read"
											>0</span
										>
										<span class="stat-text">Last Read</span>
									</div>
								</div>
							</div>
						</div>

						<div class="novel-detail-body">
							<div class="novel-description">
								<h3>Description</h3>
								<p id="modal-description"></p>
							</div>

							<!-- Website-specific metadata section -->
							<div class="novel-metadata" id="modal-metadata-container" style="display: none;">
								<!-- Rating/Warnings section for AO3/fanfic sites -->
								<div class="metadata-section" id="modal-rating-section" style="display: none;">
									<h3>Rating & Warnings</h3>
									<div class="metadata-row">
										<span class="metadata-label">Rating:</span>
										<span id="modal-rating" class="rating-badge"></span>
									</div>
									<div class="metadata-row" id="modal-warnings-row" style="display: none;">
										<span class="metadata-label">Warnings:</span>
										<div id="modal-warnings" class="tag-list warning-tags"></div>
									</div>
									<div class="metadata-row" id="modal-categories-row" style="display: none;">
										<span class="metadata-label">Categories:</span>
										<div id="modal-categories" class="tag-list category-tags"></div>
									</div>
								</div>

								<!-- Fandoms section -->
								<div class="metadata-section" id="modal-fandoms-section" style="display: none;">
									<h3>Fandoms</h3>
									<div id="modal-fandoms" class="tag-list fandom-tags"></div>
								</div>

								<!-- Relationships section -->
								<div class="metadata-section" id="modal-relationships-section" style="display: none;">
									<h3>Relationships</h3>
									<div id="modal-relationships" class="tag-list relationship-tags"></div>
								</div>

								<!-- Characters section -->
								<div class="metadata-section" id="modal-characters-section" style="display: none;">
									<h3>Characters</h3>
									<div id="modal-characters" class="tag-list character-tags"></div>
								</div>

								<!-- Additional Tags section -->
								<div class="metadata-section" id="modal-additional-tags-section" style="display: none;">
									<h3>Additional Tags</h3>
									<div id="modal-additional-tags" class="tag-list additional-tags"></div>
								</div>

								<!-- Work Stats section -->
								<div class="metadata-section" id="modal-work-stats-section" style="display: none;">
									<h3>Work Stats</h3>
									<div class="work-stats-grid" id="modal-work-stats"></div>
								</div>
							</div>

							<div
								class="novel-genres"
								id="modal-genres-container"
							>
								<h3>Genres</h3>
								<div id="modal-genres" class="genre-tags"></div>
							</div>

							<div class="novel-actions">
								<a
									id="modal-continue-btn"
									href="#"
									class="btn btn-primary"
									target="_blank"
									>Continue Reading</a
								>
								<a
									id="modal-source-btn"
									href="#"
									target="_blank"
									class="btn btn-secondary"
									target="_blank"
									>View on Site</a
								>
								<button
									id="modal-refresh-btn"
									class="btn btn-secondary"
									title="Reset manual edits and refresh metadata from source"
								>
									ğŸ”„ Refresh Metadata
								</button>
								<button
									id="modal-edit-btn"
									class="btn btn-secondary"
								>
									âœï¸ Edit Details
								</button>
								<button
									id="modal-remove-btn"
									class="btn btn-danger"
								>
									Remove from Library
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Edit Novel Modal -->
			<div id="edit-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content modal-medium">
					<button class="modal-close" id="edit-close">&times;</button>

					<h2>âœï¸ Edit Novel Details</h2>

					<form id="edit-novel-form" class="edit-form">
						<div class="form-group">
							<label for="edit-title">Title</label>
							<input
								type="text"
								id="edit-title"
								required
								placeholder="Novel title"
							/>
						</div>

						<div class="form-group">
							<label for="edit-author">Author</label>
							<input
								type="text"
								id="edit-author"
								placeholder="Author name"
							/>
						</div>

						<div class="form-group">
							<label for="edit-cover">Cover Image URL</label>
							<input
								type="url"
								id="edit-cover"
								placeholder="https://example.com/cover.jpg"
							/>
							<div
								class="cover-preview"
								id="edit-cover-preview"
							></div>
						</div>

						<div class="form-group">
							<label for="edit-description">Description</label>
							<textarea
								id="edit-description"
								rows="4"
								placeholder="Novel description/summary..."
							></textarea>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label for="edit-status">Status</label>
								<select id="edit-status">
									<option value="unknown">Unknown</option>
									<option value="ongoing">Ongoing</option>
									<option value="completed">Completed</option>
									<option value="hiatus">Hiatus</option>
									<option value="dropped">Dropped</option>
								</select>
							</div>

							<div class="form-group">
								<label for="edit-total-chapters"
									>Total Chapters</label
								>
								<input
									type="number"
									id="edit-total-chapters"
									min="0"
									placeholder="0"
								/>
							</div>
						</div>

						<div class="form-group">
							<label for="edit-genres"
								>Genres (comma-separated)</label
							>
							<input
								type="text"
								id="edit-genres"
								placeholder="Fantasy, Romance, Action"
							/>
						</div>

						<div class="form-group">
							<label for="edit-custom-prompt"
								>âœ¨ Custom Enhancement Prompt</label
							>
							<textarea
								id="edit-custom-prompt"
								rows="4"
								placeholder="Add specific instructions for enhancing this novel's chapters. This will be appended to the default prompt.&#10;&#10;Example: This novel uses Chinese cultivation terms. Preserve terms like 'Qi' and 'Dao'. The protagonist is female."
							></textarea>
							<small class="form-hint"
								>This prompt will be used whenever chapters from
								this novel are enhanced.</small
							>
						</div>

						<div class="form-actions">
							<button
								type="button"
								id="edit-cancel-btn"
								class="btn btn-secondary"
							>
								Cancel
							</button>
							<button type="submit" class="btn btn-primary">
								ğŸ’¾ Save Changes
							</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Settings Modal -->
			<div id="settings-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content modal-small">
					<button class="modal-close" id="settings-close">
						&times;
					</button>

					<h2>Library Settings</h2>

					<div class="settings-section">
						<h3>Data Management</h3>
						<div class="settings-item">
							<button id="export-btn" class="btn btn-secondary">
								ğŸ“¤ Export Library
							</button>
							<p class="settings-desc">
								Download your library data as a backup file.
							</p>
						</div>
						<div class="settings-item">
							<button id="import-btn" class="btn btn-secondary">
								ğŸ“¥ Import Library
							</button>
							<input
								type="file"
								id="import-file"
								accept=".json"
								class="hidden"
							/>
							<p class="settings-desc">
								Restore your library from a backup file.
							</p>
						</div>
						<div class="settings-item">
							<button id="clear-btn" class="btn btn-danger">
								ğŸ—‘ï¸ Clear Library
							</button>
							<p class="settings-desc">
								Remove all novels from your library. This cannot
								be undone.
							</p>
						</div>
					</div>

					<div class="settings-section">
						<h3>Reading Status Automation</h3>
						<div class="settings-item">
							<label style="display: flex; gap: 8px; align-items: center;">
								<input type="checkbox" id="auto-hold-toggle" />
								<span>Auto-set inactive novels to â€œOn Holdâ€</span>
							</label>
							<p class="settings-desc">
								Moves novels that have not been opened or updated within the configured window to the
								<em>On Hold</em> status.
							</p>
							<label for="auto-hold-days" class="settings-desc" style="display: block; margin-top: 6px;">
								Inactivity window (days)
							</label>
							<input
								type="number"
								id="auto-hold-days"
								min="1"
								max="90"
								step="1"
								value="7"
								style="width: 120px;"
							/>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Browser API polyfill for Chrome/Edge compatibility -->
		<script src="../lib/browser-polyfill.min.js"></script>

		<script type="module" src="library.js"></script>
	</body>
</html>
