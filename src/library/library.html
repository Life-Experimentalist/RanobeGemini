<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Novel Library - Ranobe Gemini</title>
		<link rel="stylesheet" href="library.css" />
		<link rel="icon" type="image/png" sizes="32x32" href="../icons/icon.png" />
	</head>

	<body>
		<div class="library-container">
			<!-- Header -->
			<header class="library-header">
				<div class="header-content">
					<div class="logo-section">
						<img src="../icons/icon.png" alt="Ranobe Gemini" class="logo light-mode-icon dark-mode-icon" />

						<h1>Novel Library</h1>
					</div>
					<div class="header-actions">
						<div class="search-box">
							<input type="text" id="search-input" placeholder="Search novels..." />
							<span class="search-icon">ğŸ”</span>
						</div>
						<button class="btn btn-icon" id="refresh-btn" title="Refresh Library">
							ğŸ”„
						</button>
						<button class="btn btn-icon" id="notification-bell-btn" title="Notifications"
							style="position: relative;">
							ğŸ””
							<span id="notification-bell-badge" class="hidden">0</span>
						</button>
						<button class="btn btn-icon" id="settings-btn" title="Library Settings">
							âš™ï¸
						</button>
					</div>
				</div>
			</header>

			<!-- Telemetry Opt-out Banner -->
			<div id="telemetry-banner" class="hidden" style="
					margin: 12px 16px 0;
					padding: 12px 16px;
					border: 1px solid var(--border-color);
					border-radius: 8px;
					background: var(--bg-tertiary);
					color: var(--text-primary);
					display: flex;
					gap: 12px;
					align-items: center;
					justify-content: space-between;
					flex-wrap: wrap;
				">
				<div style="display: flex; gap: 10px; align-items: center;">
					<span style="font-size: 16px;">ğŸ“Š</span>
					<span style="font-size: 13px; line-height: 1.4;">
						We collect anonymous usage counts to improve Ranobe Gemini.
						You can opt out now or anytime in Settings.
					</span>
				</div>
				<div style="display: flex; gap: 8px; align-items: center;">
					<button id="telemetry-banner-disable" class="btn btn-secondary">
						Opt Out
					</button>
					<button id="telemetry-banner-keep" class="btn btn-primary">
						Keep Enabled
					</button>
				</div>
			</div>
			<!-- Recent Novels Carousel -->
			<div class="carousel-section" id="carousel-section">
				<div class="carousel-header">
					<h2 class="carousel-title">ğŸ”¥ Recently Read</h2>
				</div>
				<div class="carousel-container">
					<div class="carousel-track" id="carousel-track">
						<!-- Carousel items will be populated by JavaScript -->
					</div>
				</div>
				<div class="carousel-footer">
					<button class="carousel-btn" id="carousel-prev" title="Previous">
						â—€
					</button>
					<div class="carousel-indicators" id="carousel-indicators">
						<!-- Indicators will be populated by JavaScript -->
					</div>
					<button class="carousel-btn" id="carousel-play-pause" title="Pause auto-scroll">
						â¸ï¸
					</button>
					<button class="carousel-btn" id="carousel-next" title="Next">
						â–¶
					</button>
				</div>
			</div>

			<!-- Stats Bar -->
			<div class="stats-bar">
				<div class="stat-item">
					<span class="stat-value" id="total-novels">0</span>
					<span class="stat-label">Novels</span>
				</div>
				<div class="stat-item">
					<span class="stat-value" id="total-chapters">0</span>
					<span class="stat-label">Enhanced Chapters</span>
				</div>
				<div class="stat-item">
					<span class="stat-value" id="shelf-count">0</span>
					<span class="stat-label">Active Websites</span>
				</div>
			</div>

			<!-- View Toggle -->
			<div class="view-controls">
				<div class="view-toggle">
					<button class="view-btn active" data-view="shelves" title="View by Shelves">
						ğŸ“š Shelves
					</button>
					<button class="view-btn" data-view="recent" title="Recent Novels">
						ğŸ• Recent
					</button>
					<button class="view-btn" data-view="all" title="All Novels">
						ğŸ“‹ All
					</button>
					<button class="view-btn" data-view="lists" title="Reading Lists">
						ğŸ“– Lists
					</button>
				</div>
				<div class="sort-controls">
					<label for="sort-select">Sort by:</label>
					<select id="sort-select">
						<option value="recent">Recently Read</option>
						<option value="added">Date Added</option>
						<option value="title">Title (A-Z)</option>
						<option value="chapters">Enhanced Chapters</option>
					</select>
				</div>
			</div>

			<!-- Reading Status Filter (shown in Lists view) -->
			<div id="reading-status-filter" class="reading-status-filter hidden">
				<button class="status-filter-btn active" style="align-items: center" data-status="all"
					title="All Novels">
					ğŸ“š All
				</button>
				<button class="status-filter-btn" data-status="reading" title="Currently Reading">
					ğŸ“– Reading
				</button>
				<button class="status-filter-btn" data-status="completed" title="Completed">
					âœ… Completed
				</button>
				<button class="status-filter-btn" data-status="plan-to-read" title="Plan to Read">
					ğŸ“‹ Plan to Read
				</button>
				<button class="status-filter-btn" data-status="on-hold" title="On Hold">
					â¸ï¸ On Hold
				</button>
				<button class="status-filter-btn" data-status="dropped" title="Dropped">
					âŒ Dropped
				</button>
				<button class="status-filter-btn" data-status="re-reading" title="Re-reading">
					ğŸ” Re-reading
				</button>
			</div>

			<!-- Main Content -->
			<main class="library-main">
				<!-- Shelves View -->
				<div id="shelves-view" class="view-content active">
					<!-- Shelves will be populated by JavaScript -->
				</div>

				<!-- Recent View -->
				<div id="recent-view" class="view-content">
					<h2 class="section-title">Recently Read</h2>
					<div id="recent-novels" class="novel-grid">
						<!-- Recent novels will be populated by JavaScript -->
					</div>
				</div>
				<!-- All Novels View -->
				<div id="all-view" class="view-content">
					<h2 class="section-title">All Novels</h2>
					<div id="all-novels" class="novel-grid">
						<!-- All novels will be populated by JavaScript -->
					</div>
				</div>

				<!-- Reading Lists View -->
				<div id="lists-view" class="view-content">
					<h2 class="section-title" id="lists-title">
						Reading Lists
					</h2>
					<div id="lists-stats" class="lists-stats">
						<!-- Reading status counts will be shown here -->
					</div>
					<div id="lists-novels" class="novel-grid">
						<!-- Filtered novels will be populated by JavaScript -->
					</div>
				</div>

				<!-- Empty State -->
				<div id="empty-state" class="empty-state hidden">
					<div class="empty-icon">ğŸ“š</div>
					<h2>Your Library is Empty</h2>
					<p>
						Start reading novels on supported sites and they'll
						appear here automatically when you enhance chapters.
					</p>
					<div class="supported-sites">
						<h3>Supported Sites</h3>
						<ul id="supported-sites-list">
							<!-- Dynamically populated from SHELVES -->
						</ul>
					</div>
				</div>

				<!-- Loading State -->
				<div id="loading-state" class="loading-state">
					<div class="spinner"></div>
					<p>Loading your library...</p>
				</div>
			</main>

			<!-- Novel Detail Modal -->
			<div id="novel-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content">
					<button class="modal-close" id="modal-close">
						&times;
					</button>

					<div class="novel-detail">
						<div class="novel-detail-header">
							<div id="modal-cover-container" class="novel-cover-container">
								<img id="modal-cover" src="" alt="Cover" class="novel-cover-large" />
							</div>
							<div class="novel-info">
								<h2 id="modal-title"></h2>
								<p class="novel-author">
									by <span id="modal-author"></span>
								</p>
								<div class="novel-meta">
									<span class="meta-badge" id="modal-shelf"></span>
									<span class="meta-badge" id="modal-status"></span>
									<select id="modal-status-selector" class="status-selector"
										title="Change Reading Status">
										<!-- Options populated by JavaScript from READING_STATUS_INFO -->
									</select>
								</div>
								<div class="novel-stats">
									<div class="stat">
										<span class="stat-num" id="modal-chapters">0</span>
										<span class="stat-text">Chapters</span>
									</div>
									<div class="stat">
										<span class="stat-num" id="modal-enhanced">0</span>
										<span class="stat-text">Enhanced</span>
									</div>
									<div class="stat">
										<span class="stat-num" id="modal-last-read">0</span>
										<span class="stat-text">Last Read</span>
									</div>
								</div>
							</div>
						</div>

						<div class="novel-detail-body">
							<div class="novel-description">
								<h3>Description</h3>
								<p id="modal-description"></p>
							</div>

							<!-- Website-specific metadata section -->
							<div class="novel-metadata" id="modal-metadata-container" style="display: none">
								<!-- Rating/Warnings section for AO3/fanfic sites -->
								<div class="metadata-section" id="modal-rating-section" style="display: none">
									<h3>Rating & Warnings</h3>
									<div class="metadata-row">
										<span class="metadata-label">Rating:</span>
										<span id="modal-rating" class="rating-badge"></span>
									</div>
									<div class="metadata-row" id="modal-warnings-row" style="display: none">
										<span class="metadata-label">Warnings:</span>
										<div id="modal-warnings" class="tag-list warning-tags"></div>
									</div>
									<div class="metadata-row" id="modal-categories-row" style="display: none">
										<span class="metadata-label">Categories:</span>
										<div id="modal-categories" class="tag-list category-tags"></div>
									</div>
								</div>

								<!-- Fandoms section -->
								<div class="metadata-section" id="modal-fandoms-section" style="display: none">
									<h3>Fandoms</h3>
									<div id="modal-fandoms" class="tag-list fandom-tags"></div>
								</div>

								<!-- Relationships section -->
								<div class="metadata-section" id="modal-relationships-section" style="display: none">
									<h3>Relationships</h3>
									<div id="modal-relationships" class="tag-list relationship-tags"></div>
								</div>

								<!-- Characters section -->
								<div class="metadata-section" id="modal-characters-section" style="display: none">
									<h3>Characters</h3>
									<div id="modal-characters" class="tag-list character-tags"></div>
								</div>

								<!-- Additional Tags section -->
								<div class="metadata-section" id="modal-additional-tags-section" style="display: none">
									<h3>Additional Tags</h3>
									<div id="modal-additional-tags" class="tag-list additional-tags"></div>
								</div>

								<!-- Work Stats section -->
								<div class="metadata-section" id="modal-work-stats-section" style="display: none">
									<h3>Work Stats</h3>
									<div class="work-stats-grid" id="modal-work-stats"></div>
								</div>
							</div>

							<div class="novel-genres" id="modal-genres-container">
								<h3>Genres</h3>
								<div id="modal-genres" class="genre-tags"></div>
							</div>

							<div class="novel-actions">
								<a id="modal-continue-btn" href="#" class="btn btn-primary" target="_blank">Continue
									Reading</a>
								<a id="modal-source-btn" href="#" target="_blank" class="btn btn-secondary"
									target="_blank">View on Site</a>
								<button id="modal-refresh-btn" class="btn btn-secondary"
									title="Reset manual edits and refresh metadata from source">
									ğŸ”„ Refresh Metadata
								</button>
								<button id="modal-edit-btn" class="btn btn-secondary">
									âœï¸ Edit Details
								</button>
								<button id="modal-remove-btn" class="btn btn-danger">
									Remove from Library
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Edit Novel Modal -->
			<div id="edit-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content modal-medium">
					<button class="modal-close" id="edit-close">&times;</button>

					<h2>âœï¸ Edit Novel Details</h2>

					<form id="edit-novel-form" class="edit-form">
						<div class="form-group">
							<label for="edit-title">Title</label>
							<input type="text" id="edit-title" required placeholder="Novel title" />
						</div>

						<div class="form-group">
							<label for="edit-author">Author</label>
							<input type="text" id="edit-author" placeholder="Author name" />
						</div>

						<div class="form-group">
							<label for="edit-cover">Cover Image URL</label>
							<input type="url" id="edit-cover" placeholder="https://example.com/cover.jpg" />
							<div class="cover-preview" id="edit-cover-preview"></div>
						</div>

						<div class="form-group">
							<label for="edit-description">Description</label>
							<textarea id="edit-description" rows="4"
								placeholder="Novel description/summary..."></textarea>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label for="edit-status">Status</label>
								<select id="edit-status">
									<option value="unknown">Unknown</option>
									<option value="ongoing">Ongoing</option>
									<option value="completed">Completed</option>
									<option value="hiatus">Hiatus</option>
									<option value="dropped">Dropped</option>
								</select>
							</div>

							<div class="form-group">
								<label for="edit-total-chapters">Total Chapters</label>
								<input type="number" id="edit-total-chapters" min="0" placeholder="0" />
							</div>
						</div>

						<div class="form-group">
							<label for="edit-genres">Genres (comma-separated)</label>
							<input type="text" id="edit-genres" placeholder="Fantasy, Romance, Action" />
						</div>

						<div class="form-group">
							<label for="edit-custom-prompt">âœ¨ Custom Enhancement Prompt</label>
							<textarea id="edit-custom-prompt" rows="4"
								placeholder="Add specific instructions for enhancing this novel's chapters. This will be appended to the default prompt.&#10;&#10;Example: This novel uses Chinese cultivation terms. Preserve terms like 'Qi' and 'Dao'. The protagonist is female."></textarea>
							<small class="form-hint">This prompt will be used whenever chapters from
								this novel are enhanced.</small>
						</div>

						<div class="form-actions">
							<button type="button" id="edit-cancel-btn" class="btn btn-secondary">
								Cancel
							</button>
							<button type="submit" class="btn btn-primary">
								ğŸ’¾ Save Changes
							</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Settings Modal -->
			<div id="settings-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content settings-modal-content">
					<button class="modal-close" id="settings-close">
						&times;
					</button>

					<h2 style="margin-bottom: 8px;">âš™ï¸ Library Settings</h2>
					<p style="margin: 0 0 16px 0; font-size: 13px; color: var(--text-secondary, #999);">
						Manage your library data, backups, and preferences
					</p>

					<!-- Settings Tabs -->
					<div class="settings-tabs" style="overflow-x: auto;">
						<button class="settings-tab active" data-tab="general-settings">
							ğŸ’¾ General
						</button>
						<button class="settings-tab" data-tab="backup-settings">
							â˜ï¸ Backups
						</button>
						<button class="settings-tab" data-tab="automation-settings">
							âš¡ Automation
						</button>
						<button class="settings-tab" data-tab="site-settings">
							ğŸŒ Sites
						</button>
						<button class="settings-tab" data-tab="prompt-settings">
							âœï¸ Prompts
						</button>
						<button class="settings-tab" data-tab="advanced-settings">
							âš™ï¸ Advanced
						</button>
					</div>

					<!-- General Settings Tab -->
					<div class="settings-tab-content" id="general-settings">
						<div class="settings-grid">
							<!-- SECTION: Theme Settings (1/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #f97316;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #f97316;">
									ğŸ¨ Theme
								</h3>
								<div class="settings-item">
									<label for="library-theme-mode"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Mode
									</label>
									<select id="library-theme-mode"
										style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; margin-bottom: 8px;">
										<option value="dark">ğŸŒ™ Dark</option>
										<option value="light">â˜€ï¸ Light</option>
										<option value="auto">ğŸ”„ Auto</option>
									</select>
								</div>
								<div class="settings-item theme-color-grid">
									<div class="theme-color-field">
										<label for="library-accentColorPicker">Accent Primary</label>
										<div class="color-row">
											<input type="color" id="library-accentColorPicker" value="#4b5563"
												style="width: 46px; height: 34px; border: none; border-radius: 6px; cursor: pointer;" />
											<input type="text" id="library-accentColorText" value="#4b5563"
												style="flex: 1; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										</div>
									</div>
									<div class="theme-color-field">
										<label for="library-accentSecondaryPicker">Accent Secondary</label>
										<div class="color-row">
											<input type="color" id="library-accentSecondaryPicker" value="#6b7280"
												style="width: 46px; height: 34px; border: none; border-radius: 6px; cursor: pointer;" />
											<input type="text" id="library-accentSecondaryText" value="#6b7280"
												style="flex: 1; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										</div>
									</div>
									<div class="theme-color-field">
										<label for="library-backgroundColorPicker">Background</label>
										<div class="color-row">
											<input type="color" id="library-backgroundColorPicker" value="#111827"
												style="width: 46px; height: 34px; border: none; border-radius: 6px; cursor: pointer;" />
											<input type="text" id="library-backgroundColorText" value="#111827"
												style="flex: 1; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										</div>
									</div>
									<div class="theme-color-field">
										<label for="library-textColorPicker">Text</label>
										<div class="color-row">
											<input type="color" id="library-textColorPicker" value="#e5e7eb"
												style="width: 46px; height: 34px; border: none; border-radius: 6px; cursor: pointer;" />
											<input type="text" id="library-textColorText" value="#e5e7eb"
												style="flex: 1; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										</div>
									</div>
								</div>

								<div class="settings-item theme-actions">
									<button id="library-reset-theme" class="btn btn-danger"
										style="font-size: 11px; padding: 6px 8px;">
										Reset
									</button>
									<button id="library-save-theme" class="btn btn-primary"
										style="font-size: 11px; padding: 6px 8px;">
										Save Theme
									</button>
								</div>
								<br>
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #ec4899;">
									ğŸ”¤ Font Size
								</h3>
								<div class="settings-item theme-actions">
									<label
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Size: <span id="library-font-size-value" style="color: #ec4899;">100%</span>
									</label>
									<input type="range" id="library-font-size-slider" min="80" max="150" step="5"
										value="100" style="width: 100%; cursor: pointer;" />
									<p class="settings-desc" style="font-size: 11px;">
										80% - 150%
									</p>
								</div>

							</div>

							<!-- SECTION: AI Model Settings (1/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #3b82f6;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #3b82f6;">
									ğŸ¤– AI Model
								</h3>
								<div class="settings-item">
									<label for="library-api-key"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Gemini API Key
									</label>
									<div class="settings-inline">
										<input type="password" id="library-api-key" placeholder="Gemini API Key 'AI...'"
											style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										<div class="settings-inline-actions">
											<button id="library-save-api-key" class="btn btn-secondary"
												style="font-size: 11px; padding: 6px 8px;">
												Save
											</button>
											<button id="library-test-api-key" class="btn btn-secondary"
												style="font-size: 11px; padding: 6px 8px;">
												Test
											</button>
										</div>
									</div>
									<p class="settings-desc" style="font-size: 11px;">
										Needed to fetch models and use Gemini.
									</p>
								</div>
								<div class="settings-item">
									<label for="library-model-select"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Model
									</label>
									<div class="settings-inline">
										<select id="library-model-select"
											style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;">
											<option value="gemini-2.0-flash">Gemini 2.0 Flash (Recommended)</option>
											<option value="gemini-2.5-flash">Gemini 2.5 Flash (Faster)</option>
											<option value="gemini-2.5-pro">Gemini 2.5 Pro (Better quality)</option>
										</select>
										<button id="library-refresh-models" class="btn btn-secondary"
											style="font-size: 11px; padding: 6px 8px;">
											Refresh
										</button>
									</div>
									<p class="settings-desc" style="font-size: 11px;">
										Model list updates using your API key.
									</p>
								</div>
								<div class="settings-item">
									<label for="library-model-endpoint"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Model Endpoint URL
									</label>
									<div class="settings-inline">
										<input type="text" id="library-model-endpoint" readonly
											placeholder="https://generativelanguage.googleapis.com/..."
											style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 11px;" />
										<button id="library-copy-model-endpoint" class="btn btn-secondary"
											style="font-size: 11px; padding: 6px 8px;">
											Copy
										</button>
									</div>
									<p class="settings-desc" style="font-size: 11px;">
										Auto-generated from selected model.
									</p>
								</div>
								<div class="settings-item">
									<label
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Temperature: <span id="library-temperature-value"
											style="color: #3b82f6;">0.7</span>
									</label>
									<input type="range" id="library-temperature-slider" min="0" max="1" step="0.1"
										value="0.7" style="width: 100%; cursor: pointer;" />
									<p class="settings-desc" style="font-size: 11px;">
										0=Deterministic, 1=Creative
									</p>
								</div>
							</div>

							<!-- SECTION: Backup API Keys (1/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #10b981;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #10b981;">
									ğŸ”‘ Backup API Keys
								</h3>
								<div class="settings-item">
									<div id="library-backup-keys-list"
										style="max-height: 150px; overflow-y: auto; margin-bottom: 8px; padding: 4px; background: var(--bg-tertiary, rgba(0,0,0,0.2)); border-radius: 4px; border: 1px solid var(--border-color);">
										<!-- Backup keys will be populated here -->
									</div>
									<div style="display: flex; gap: 6px; margin-bottom: 12px;">
										<input type="password" id="library-new-backup-key"
											placeholder="Add backup API key..."
											style="flex: 1; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										<button id="library-add-backup-key" class="btn btn-secondary"
											style="font-size: 11px; padding: 6px 12px;">
											â• Add
										</button>
									</div>
									<label for="library-api-key-rotation"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Rotation Strategy
									</label>
									<select id="library-api-key-rotation"
										style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;">
										<option value="off">Off</option>
										<option value="round_robin">Round Robin</option>
										<option value="random">Random</option>
									</select>
									<p class="settings-desc" style="font-size: 11px; margin-top: 4px;">
										Auto-use backup keys if primary hits rate limits
									</p>
								</div>
							</div>

							<!-- SECTION: URL Import (FULL WIDTH) -->
							<div class="settings-section" data-full-width="true"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #38bdf8;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #38bdf8;">
									ğŸ”— Import URLs
								</h3>
								<p class="settings-desc" style="margin-bottom: 10px; font-size: 12px;">
									Paste any text and we'll extract supported novel URLs, open them in the background,
									and add them to your library.
								</p>
								<textarea id="url-import-text" rows="5" placeholder="Paste links or text here..."
									style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; resize: vertical;"></textarea>
								<div style="display: flex; gap: 8px; margin-top: 10px;">
									<button id="url-import-btn" class="btn btn-primary"
										style="font-size: 12px; padding: 8px 12px;">
										â• Add URLs to Library
									</button>
									<button id="url-import-clear" class="btn btn-secondary"
										style="font-size: 12px; padding: 8px 12px;">
										Clear
									</button>
								</div>
								<p class="settings-desc" id="url-import-status"
									style="margin-top: 8px; font-size: 11px;">
									Ready to import.
								</p>
							</div>

						</div>
					</div>

					<!-- Backup Settings Tab -->
					<div class="settings-tab-content hidden" id="backup-settings">
						<div class="settings-grid">
							<!-- LOCAL BACKUPS HEADER -->
							<div class="settings-section" data-full-width="true"
								style="background: rgba(52, 168, 83, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #34a853;">
								<h3 style="margin: 0 0 6px 0; font-size: 16px; font-weight: 600; color: #34a853;">ğŸ’¾
									Local Backups</h3>
								<p class="settings-desc" style="margin: 0; font-size: 11px;">
									Create and manage backups stored in your browser.
								</p>
							</div>

							<!-- SECTION 1: Comprehensive Backup (Recommended) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #34a853;">
								<h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: 600; color: #34a853;">
									ğŸ“¦ Comprehensive Backup (Recommended)
								</h3>
								<p class="settings-desc" style="margin-bottom: 12px; font-size: 11px;">
									Complete backup including library, API keys, prompts, theme, and all settings.
								</p>

								<div class="settings-item" style="margin-bottom: 12px;">
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px; cursor: pointer;">
										<input type="checkbox" id="backupIncludeApiKeys" checked />
										<span style="font-weight: 500; font-size: 12px;">Include API keys and
											credentials</span>
									</label>
									<label style="display: flex; gap: 8px; align-items: center; cursor: pointer;">
										<input type="checkbox" id="backupIncludeCredentials" checked />
										<span style="font-weight: 500; font-size: 12px;">Include OAuth
											credentials</span>
									</label>
								</div>

								<div class="settings-item"
									style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
									<button id="createComprehensiveBackup" class="btn btn-secondary"
										style="font-size: 12px; padding: 8px;">
										ğŸ’¾ Full Backup
									</button>
									<button id="restoreComprehensiveBackup" class="btn btn-secondary"
										style="font-size: 12px; padding: 8px;">
										ğŸ“‚ Restore Full
									</button>
									<input type="file" id="comprehensiveBackupFile" accept=".json" class="hidden" />
								</div>

								<div class="settings-item">
									<label style="display: flex; gap: 8px; align-items: center; cursor: pointer;">
										<input type="checkbox" id="autoBackupEnabled" checked />
										<span style="font-weight: 500; font-size: 12px;">Enable automatic rolling
											backups</span>
									</label>
									<p class="settings-desc" style="font-size: 11px; margin-top: 4px;">
										Creates browser-stored backups automatically when your library changes (keeps
										last 5).
									</p>
									<div style="margin-top: 10px;">
										<label
											style="display: block; font-weight: 600; font-size: 12px; margin-bottom: 4px;">
											Frequency: <span id="rollingBackupIntervalDisplay"
												style="color: #34a853;">60</span> minutes
										</label>
										<div id="carousel-manual-container" style="display: none;">
											<input type="number" id="rollingBackupInterval" min="5" value="360"
												style="width: 120px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
											<p class="settings-desc" style="font-size: 11px; margin-top: 4px;">
												Sets how often a rolling backup is created automatically.
											</p>
										</div>
									</div>
								</div>
							</div>

							<!-- SECTION 2: Rolling Backups (Browser Storage, Max 5) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #667eea;">
								<h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: 600; color: #667eea;">
									ğŸ”„ Rolling Backups (Browser Storage, Max 5)
								</h3>
								<p class="settings-desc" style="margin-bottom: 12px; font-size: 11px;">
									Automatic backups stored in browser memory. Most recent 5 are kept.
								</p>

								<!-- Backup Status Indicator -->
								<div id="rollingBackupStatus"
									style="background: rgba(102, 126, 234, 0.1); padding: 12px; border-radius: 6px; margin-bottom: 12px; border: 1px solid rgba(102, 126, 234, 0.3); display: none;">
									<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
										<span id="backupStatusIcon" style="font-size: 14px;">â³</span>
										<span id="backupStatusText"
											style="font-size: 12px; font-weight: 500; color: #667eea;">Backup
											status...</span>
									</div>
									<div id="backupCountdownContainer" style="display: none; margin-top: 8px;">
										<div
											style="font-size: 11px; color: var(--text-secondary, #9ca3af); margin-bottom: 6px;">
											Next automatic backup in:
										</div>
										<div style="font-size: 13px; font-weight: 600; color: #4f46e5;">
											<span id="backupCountdownTime">--:--</span>
										</div>
									</div>
									<div id="lastBackupTime"
										style="font-size: 10px; color: var(--text-secondary, #9ca3af); margin-top: 8px; display: none;">
										Last backup: <span id="lastBackupTimeText">Never</span>
									</div>
								</div>

								<div id="rollingBackupList" style="margin-top: 8px;">
									<div class="no-backups"
										style="text-align: center; padding: 15px; color: #888; font-size: 12px;">
										No rolling backups yet. Enable auto-backup or create one manually.
									</div>
								</div>
								<button id="createRollingBackup" class="btn btn-secondary"
									style="width: 100%; margin-top: 8px; font-size: 12px; padding: 8px;">
									â• Create Rolling Backup Now
								</button>
							</div>

							<!-- SECTION 4: Import & Merge Options -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
								<h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: 600; color: #8b5cf6;">
									âš™ï¸ Import & Merge Options
								</h3>
								<p class="settings-desc" style="margin-bottom: 12px; font-size: 11px;">
									Choose how backups are restored to your library.
								</p>
								<div class="settings-item" style="margin-bottom: 8px;">
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px; cursor: pointer;">
										<input type="radio" name="mergeMode" value="merge" checked />
										<span style="font-weight: 500; font-size: 12px;">Merge (Recommended)</span>
									</label>
									<p class="settings-desc"
										style="font-size: 11px; margin-left: 28px; margin-bottom: 8px;">
										Combines backup with existing data. Newer entries take priority. Preserves your
										current library.
									</p>
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px; cursor: pointer;">
										<input type="radio" name="mergeMode" value="replace" />
										<span style="font-weight: 500; font-size: 12px;">Replace</span>
									</label>
									<p class="settings-desc" style="font-size: 11px; margin-left: 28px;">
										Completely replaces your library with the backup. <strong
											style="color: #f59e0b;">Use with caution!</strong>
									</p>
								</div>
							</div>

							<!-- SECTION: Data Management (1/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid var(--accent-secondary, #667ee6);">
								<h3
									style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: var(--accent-secondary, #667ee6);">
									ğŸ’¾ Data Management
								</h3>
								<h4
									style="margin: 0 0 12px 0; font-size: 11px; font-weight: 600; color: var(--accent-secondary, #f59e0b);">
									(Deprecated will be removed soon; for legacy support)</h4>
								<div class="settings-item" style="margin-bottom: 12px; width: 100%;">
									<button id="export-btn" class="btn btn-secondary"
										style="width: 100%; font-size: 12px; padding: 8px;">
										ğŸ“¤ Export
									</button>
									<p class="settings-desc" style="font-size: 11px;">
										Download library data
									</p>
								</div>

								<div class="settings-item" style="margin-bottom: 12px; width: 100%;">
									<button id="import-btn" class="btn btn-secondary"
										style="width: 100%; font-size: 12px; padding: 8px;">
										ğŸ“¥ Import
									</button>
									<input type="file" id="import-file" accept=".json" class="hidden" />
									<p class="settings-desc" style="font-size: 11px;">
										Restore from backup
									</p>
								</div>

								<div class="settings-item" style="width: 100%;">
									<button id="clear-btn" class="btn btn-danger"
										style="width: 100%; font-size: 12px; padding: 8px;">
										ğŸ—‘ï¸ Clear
									</button>
									<p class="settings-desc" style="font-size: 11px;">
										Remove all novels
									</p>
								</div>
							</div>


							<!-- GOOGLE DRIVE BACKUPS HEADER -->
							<div class="settings-section" data-full-width="true"
								style="background: rgba(66, 133, 244, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #4285f4; margin-top: 16px;">
								<h3 style="margin: 0 0 6px 0; font-size: 16px; font-weight: 600; color: #f59e0b;">â˜ï¸
									Google Drive Backups</h3>
								<p class="settings-desc" style="margin: 0; font-size: 11px;">
									Cloud storage with automatic sync and version history.
								</p>
							</div>

							<!-- SECTION 5: Google Drive Backup -->
							<div class="settings-section" data-full-width="true"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #34a853;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #f59e0b;">
									â˜ï¸ Google Drive
								</h3>
								<p class="settings-desc" style="margin-bottom: 12px; font-size: 11px;">
									Connect Drive, sync, and manage backups here.
								</p>

								<div
									style="margin-bottom: 12px; padding: 10px; background: rgba(66, 133, 244, 0.1); border-radius: 6px; border-left: 3px solid #4285F4">
									<div
										style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px">
										<label style="font-weight: bold; color: #4285F4">
											â˜ï¸ Google Drive Backup
										</label>
										<span id="driveStatus" style="font-size: 12px; color: #666">
											Disconnected
										</span>
									</div>

									<div id="driveNotConnected" style="margin-bottom: 10px">
										<p style="font-size: 12px; margin: 0 0 8px 0">
											Backup your library to Google Drive with automatic version history and easy
											restore.
										</p>
										<div id="driveAuthError" class="settings-desc"
											style="display: none; margin-bottom: 8px; color: #f59e0b; font-size: 11px">
										</div>
										<button id="connectDriveBtn" class="btn btn-secondary"
											style="width: 100%; margin-bottom: 8px">
											ğŸ”— Connect Google Drive
										</button>
									</div>

									<div id="driveConnected" style="display: none">
										<div style="margin-bottom: 12px">
											<label
												style="font-weight: bold; font-size: 13px; margin-bottom: 8px; display: block; color: #4285F4">âš™ï¸
												Backup Mode:</label>
											<div
												style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 8px">
												<!-- Scheduled Option -->
												<label class="backup-mode-card"
													style="display: flex; flex-direction: column; padding: 12px; background: var(--bg-tertiary, rgba(255,255,255,0.05)); border: 2px solid var(--border-color, #374151); border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative;">
													<input type="radio" name="driveBackupMode" id="driveScheduled"
														value="scheduled" checked
														style="position: absolute; opacity: 0; width: 0; height: 0;" />
													<div
														style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
														<span style="font-size: 18px;">ğŸ“…</span>
														<span
															style="font-weight: 600; font-size: 12px;">Scheduled</span>
													</div>
													<p
														style="margin: 0; font-size: 10px; color: var(--text-secondary, #9ca3af); line-height: 1.4;">
														Daily versioned backups at regular intervals</p>
												</label>
												<!-- Continuous Option -->
												<label class="backup-mode-card"
													style="display: flex; flex-direction: column; padding: 12px; background: var(--bg-tertiary, rgba(255,255,255,0.05)); border: 2px solid var(--border-color, #374151); border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative;">
													<input type="radio" name="driveBackupMode" id="driveContinuous"
														value="continuous"
														style="position: absolute; opacity: 0; width: 0; height: 0;" />
													<div
														style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
														<span style="font-size: 18px;">ğŸ”„</span>
														<span
															style="font-weight: 600; font-size: 12px;">Continuous</span>
													</div>
													<p
														style="margin: 0; font-size: 10px; color: var(--text-secondary, #9ca3af); line-height: 1.4;">
														Auto-backup when changes detected every N minutes</p>
												</label>
												<!-- Both Option -->
												<label class="backup-mode-card"
													style="display: flex; flex-direction: column; padding: 12px; background: var(--bg-tertiary, rgba(255,255,255,0.05)); border: 2px solid var(--border-color, #374151); border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative;">
													<input type="radio" name="driveBackupMode" id="driveBoth"
														value="both"
														style="position: absolute; opacity: 0; width: 0; height: 0;" />
													<div
														style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
														<span style="font-size: 18px;">âš¡</span>
														<span style="font-weight: 600; font-size: 12px;">Both</span>
													</div>
													<p
														style="margin: 0; font-size: 10px; color: var(--text-secondary, #9ca3af); line-height: 1.4;">
														Scheduled daily + continuous change detection</p>
												</label>
											</div>
											<style>
												.backup-mode-card:has(input:checked) {
													border-color: #4285F4 !important;
													background: rgba(66, 133, 244, 0.15) !important;
												}

												.backup-mode-card:hover {
													border-color: #4285F4;
													transform: translateY(-2px);
													box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
												}
											</style>
										</div>

										<!-- Continuous Backup Check Interval -->
										<div style="margin-bottom: 12px; padding: 10px; background: rgba(66, 133, 244, 0.08); border-radius: 6px; border-left: 3px solid #34a853"
											id="continuousBackupCheckContainer">
											<label
												style="display: block; font-weight: 600; font-size: 12px; margin-bottom: 6px; color: #667ee6">
												ğŸ”„ Check for changes every:
												<span id="continuousCheckIntervalDisplay"
													style="color: #4285F4; font-weight: bold; font-size: 13px;">2</span>
												minutes
											</label>
											<input type="range" id="continuousBackupCheckInterval" min="1" max="60"
												value="2" style="width: 100%; cursor: pointer;" />
											<div class="settings-desc"
												style="font-size: 10px; margin-top: 4px; color: var(--text-secondary, #9ca3af);">
												âš¡ Lower = more frequent checks, higher = less CPU usage. Backup triggers
												instantly when changes detected.
											</div>
										</div>

										<!-- Drive Backup Retention -->
										<div
											style="margin-bottom: 12px; padding: 10px; background: rgba(66, 133, 244, 0.08); border-radius: 6px; border-left: 3px solid #f59e0b">
											<label
												style="display: block; font-weight: 600; font-size: 12px; margin-bottom: 6px; color: #f59e0b">
												ğŸ—‚ï¸ Backup Policy (Per Google Account)
											</label>
											<div
												style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 4px; font-size: 11px; color: var(--text-secondary, #9ca3af); margin-bottom: 8px;">
												<div style="margin-bottom: 4px;"><strong>ğŸ“… Manual Backups:</strong>
													Keep 4 (daily auto + user-created)</div>
												<div><strong>ğŸ”„ Continuous:</strong> Keep 1 (real-time sync backup)
												</div>
												<div style="font-size: 10px; margin-top: 6px; font-style: italic;">ğŸ’¡
													Oldest backups deleted automatically. This quota is <strong>unified
														per Google Account</strong> across all browsers.</div>
											</div>
											<div class="settings-desc"
												style="font-size: 10px; color: var(--text-secondary, #9ca3af);">
												All browsers linked to this Google Account share the same backup quota.
												Backups automatically managed based on creation time.
											</div>
										</div>

										<div style="margin-bottom: 8px">
											<label
												style="display: flex; align-items: center; gap: 6px; font-size: 12px">
												<input type="checkbox" id="driveAutoRestoreEnabled" />
												<span>Auto-restore from Drive (merge latest)</span>
											</label>
											<div class="settings-desc" style="font-size: 11px; margin-top: 4px">
												Checks Drive every 10 minutes and merges the newest backup.
											</div>
										</div>

										<!-- Drive Action Buttons -->
										<div
											style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
											<button id="backupNowBtn" class="drive-action-btn"
												style="background: linear-gradient(135deg, #34a853 0%, #2d9447 100%); color: white; border: none; border-radius: 8px; padding: 12px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(52, 168, 83, 0.3);">
												<span style="font-size: 16px;">ğŸ“¤</span>
												<span>Backup Now</span>
											</button>
											<button id="library-view-backups-btn" class="drive-action-btn"
												style="background: linear-gradient(135deg, #4285F4 0%, #3367d6 100%); color: white; border: none; border-radius: 8px; padding: 12px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(66, 133, 244, 0.3);">
												<span style="font-size: 16px;">ğŸ“‹</span>
												<span>View Backups</span>
											</button>
											<button id="library-sync-from-drive-btn" class="drive-action-btn"
												style="background: linear-gradient(135deg, #fbbc04 0%, #f9ab00 100%); color: #1a1a1a; border: none; border-radius: 8px; padding: 12px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(251, 188, 4, 0.3);">
												<span style="font-size: 16px;">ğŸ”„</span>
												<span>Sync from Drive</span>
											</button>
											<button id="disconnectDriveBtn" class="drive-action-btn"
												style="background: linear-gradient(135deg, #ea4335 0%, #d33b2c 100%); color: white; border: none; border-radius: 8px; padding: 12px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(234, 67, 53, 0.3);">
												<span style="font-size: 16px;">ğŸ”Œ</span>
												<span>Disconnect</span>
											</button>
										</div>
										<style>
											.drive-action-btn:hover {
												transform: translateY(-2px);
												box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
											}

											.drive-action-btn:active {
												transform: translateY(0);
											}
										</style>
									</div>
									</details>

									<!-- Disconnect Button -->
									<button id="disconnectDriveBtn" class="drive-action-btn"
										style="background: linear-gradient(135deg, #ea4335 0%, #d33b2c 100%); color: white; border: none; border-radius: 8px; padding: 10px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 6px rgba(234, 67, 53, 0.3); width: 100%;">
										<span style="font-size: 14px">ğŸ”Œ</span>
										<span>Disconnect Drive</span>
									</button>
									<style>
										.drive-action-btn:hover {
											transform: translateY(-2px);
											box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
										}

										.drive-action-btn:active {
											transform: translateY(0);
										}
									</style>
								</div>
								<summary
									style="cursor: pointer; font-weight: 600; font-size: 13px; color: var(--text-primary, #9fb3c8); padding: 8px 0; display: flex; align-items: center; gap: 6px; list-style: none; user-select: none">
									<span>ğŸ”§</span>
									<span>OAuth Setup (Required for Google Drive)</span>
									<span style="flex: 1"></span>
									<span
										style="font-size: 11px; color: var(--text-secondary, #999); font-weight: normal">(Takes
										2 minutes)</span>
								</summary>
								<div
									style="margin-top: 12px; padding: 10px; background: var(--accent-secondary, rgba(66, 133, 244, 0.05)); border-radius: 6px">
									<div style="display: flex; gap: 12px; align-items: flex-start">
										<div style="flex: 1">
											<p
												style="font-size: 12px; margin: 0 0 6px 0; color: var(--accent-secondary, #4285F4); font-weight: 600">
												â„¹ï¸ What is OAuth Setup?</p>
											<a href="https://ranobe.vkrishna04.me/drive-setup.html" target="_blank"
												style="color: var(--accent-secondary, #4285F4); font-size: 11px; display: inline-block; margin-top: 6px; text-decoration: none; font-weight: 500">
												<p
													style="font-size: 11px; margin: 0; color: var(--text-secondary, #666)">
													Create free Google OAuth credentials to enable automatic
													backups. This is a one-time setup.
													ğŸ“– Detailed Setup Guide â†’
												</p>
											</a>
										</div>
									</div>
								</div>

								<div style="margin-top: 14px; display: grid; gap: 12px">
									<!-- JSON Upload Method -->
									<div
										style="padding: 10px; background: var(--accent-primary, rgba(66, 133, 244, 0.05)); border-radius: 6px; border: 1px solid var(--border-color, #1f2937)">
										<label
											style="font-size: 12px; font-weight: 600; color: var(--text-primary, #1f2937); display: block; margin-bottom: 6px">
											ğŸ“‹ Method 1: Paste OAuth JSON (Recommended)
										</label>
										<p
											style="font-size: 11px; color: var(--text-secondary, #666); margin: 0 0 6px 0">
											Download your credentials JSON file from Google Cloud Console and
											paste here:
										</p>
										<textarea id="oauthJsonPaste"
											placeholder='Paste your client_secret_*.json file contents here...'
											style="width: 100%; height: 70px; font-family: 'Courier New', monospace; font-size: 10px; resize: vertical; padding: 6px; border: 1px solid var(--border-color, #d1d5db); border-radius: 4px; background: var(--bg-tertiary); color: var(--text-primary, black)"></textarea>
										<div
											style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px">
											<button id="parseOAuthJson" class="btn btn-secondary"
												style="font-size: 11px; padding: 6px">
												âœ“ Parse JSON
											</button>
											<button id="saveOAuthFromJson" class="btn btn-secondary"
												style="font-size: 11px; padding: 6px">
												ğŸ’¾ Save to Storage
											</button>
										</div>
									</div>

									<!-- Manual Entry Method -->
									<div
										style="padding: 10px; background: var(--accent-primary, rgba(66, 133, 244, 0.05)); border-radius: 6px; border: 1px solid var(--border-color, #1f2937)">
										<label
											style="font-size: 12px; font-weight: 600; color: var(--text-primary, #1f2937); display: block; margin-bottom: 6px">
											âœï¸ Method 2: Manual Entry
										</label>
										<p
											style="font-size: 11px; color: var(--text-secondary, #666); margin: 0 0 6px 0">
											Copy from Google Cloud Console
										</p>
										<label for="driveClientId"
											style="font-size: 11px; color: var(--text-secondary, #666); display: block; margin-bottom: 3px">
											Client ID:
										</label>
										<input id="driveClientId" type="text" placeholder="Your OAuth Client ID"
											style="width: 100%; padding: 6px; border: 1px solid var(--border-color, #d1d5db); border-radius: 4px; font-size: 11px; margin-bottom: 6px; background: var(--bg-tertiary); color: var(--text-primary, black)" />
										<label for="driveClientSecret"
											style="font-size: 11px; color: var(--text-secondary, #666); display: block; margin-bottom: 3px">
											Client Secret:
										</label>
										<div style="position: relative">
											<input id="driveClientSecret" type="password"
												placeholder="Client Secret (optional)"
												style="width: 100%; padding: 6px; border: 1px solid var(--border-color, #d1d5db); border-radius: 4px; font-size: 11px; background: var(--bg-tertiary); color: var(--text-primary, black); padding-right: 30px" />
											<button id="toggleClientSecretVisibility" type="button"
												title="Show/Hide Client Secret"
												style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; padding: 4px; font-size: 14px; line-height: 1; color: var(--text-secondary, #9ca3af); transition: color 0.2s;">
												ğŸ‘ï¸
											</button>
										</div>

										<button id="saveOAuthSettings" class="btn btn-secondary"
											style="width: 100%; font-size: 11px; padding: 6px; margin-top: 6px;">
											ğŸ’¾ Save Credentials
										</button>
									</div>
								</div>

								<!-- Optional Folder ID - Hidden for now (not working properly) -->
								<div
									style="display: none; padding: 10px; background: var(--accent-primary, #f8f9fa); border-radius: 6px; border: 1px solid var(--border-color, #e5e7eb)">
									<label
										style="font-size: 12px; font-weight: 600; color: var(--text-primary, #1f2937); display: block; margin-bottom: 6px">
										ğŸ“ Optional: Specify Drive Folder
									</label>
									<label for="driveFolderId"
										style="font-size: 11px; color: var(--text-secondary, #666); display: block; margin-bottom: 3px">
										Folder ID (leave empty for auto-create):
									</label>
									<input id="driveFolderId" type="text" placeholder="e.g., 1a2b3c4d5e6f7g8h9i0j..."
										style="width: 100%; padding: 6px; border: 1px solid var(--border-color, #d1d5db); border-radius: 4px; font-size: 11px; margin-bottom: 4px; background: var(--input-bg, white); color: var(--text-primary, black)" />
									<p style="font-size: 10px; color: var(--text-secondary, #999); margin: 0">
										ğŸ’¡ How to find Folder ID: Open a folder in Google Drive â†’ Copy the ID
										from the URL (after /folders/)
									</p>
								</div>
								</details>
							</div>
						</div>
					</div>


					<!-- Automation Settings Tab -->
					<div class="settings-tab-content hidden" id="automation-settings">
						<div class="settings-grid">
							<!-- SECTION: Carousel Configuration (1/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #8b5cf6;">
									ğŸ  Carousel Settings
								</h3>
								<div class="settings-item">
									<label
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Recent Novels Count
									</label>
									<p class="settings-desc" style="margin-bottom: 8px; font-size: 11px;">
										Auto-calculated: <span id="carousel-auto-count"
											style="color: #8b5cf6; font-weight: 600;">10</span>
										<span style="color: var(--text-secondary);">(Active sites + 5, min 10)</span>
									</p>
									<div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
										<label style="display: flex; gap: 6px; align-items: center; cursor: pointer;">
											<input type="checkbox" id="carousel-use-manual" />
											<span style="font-weight: 500; font-size: 12px;">Manual override</span>
										</label>
									</div>
									<div id="carousel-manual-container" style="display: none;">
										<input type="number" id="carousel-manual-count" min="1" max="100" step="1"
											value="10"
											style="width: 120px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
										<p class="settings-desc" style="margin-top: 4px; font-size: 11px;">
											1-100 novels (overrides automatic calculation)
										</p>
									</div>
								</div>
							</div>

							<!-- SECTION 3: Reading Status Automation (2/4) -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #f59e0b;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #f59e0b;">
									â° Auto-Hold
								</h3>
								<div class="settings-item">
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px; cursor: pointer;">
										<input type="checkbox" id="auto-hold-toggle" />
										<span style="font-weight: 500; font-size: 12px;">Enable</span>
									</label>
									<p class="settings-desc" style="margin-bottom: 10px; font-size: 11px;">
										Mark inactive as "On Hold"
									</p>
									<label for="auto-hold-days" class="settings-desc"
										style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 11px;">
										Days inactivity:
									</label>
									<input type="number" id="auto-hold-days" min="1" max="90" step="1" value="7"
										style="width: 80px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
								</div>
							</div>

						</div>
					</div>

					<!-- Prompt Settings Tab -->
					<div class="settings-tab-content hidden" id="prompt-settings">
						<div class="settings-grid">
							<!-- SECTION: Prompts (full width) -->
							<div class="settings-section" data-full-width="true"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #10b981;">
								<h3>âœï¸ Prompt Templates</h3>

								<!-- Main Enhancement Prompt -->
								<div class="settings-item">
									<label for="library-prompt-main">Main Enhancement Prompt</label>
									<textarea id="library-prompt-main" rows="4"
										style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; font-family: monospace;"></textarea>
									<button id="library-reset-prompt-main" class="btn btn-secondary"
										style="font-size: 11px; margin-top: 4px;">Reset to
										Default</button>
								</div>

								<!-- Summary Prompt -->
								<div class="settings-item">
									<label for="library-prompt-summary">Summary Prompt</label>
									<textarea id="library-prompt-summary" rows="3"
										style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; font-family: monospace;"></textarea>
									<button id="library-reset-prompt-summary" class="btn btn-secondary"
										style="font-size: 11px; margin-top: 4px;">Reset to
										Default</button>
								</div>

								<details class="settings-item"
									style="padding: 12px; background: var(--bg-tertiary, rgba(255,255,255,0.04)); border-radius: 6px; border: 1px solid var(--border-color);">
									<summary style="cursor: pointer; font-weight: 600;">More Prompt Options</summary>

									<div class="settings-item" style="margin-top: 10px;">
										<label for="library-prompt-short-summary">Short Summary Prompt</label>
										<textarea id="library-prompt-short-summary" rows="2"
											style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; font-family: monospace;"></textarea>
										<button id="library-reset-prompt-short-summary" class="btn btn-secondary"
											style="font-size: 11px; margin-top: 4px;">Reset to Default</button>
									</div>

									<div class="settings-item" style="margin-top: 10px;">
										<label for="library-prompt-permanent">Permanent Context Prompt</label>
										<textarea id="library-prompt-permanent" rows="3"
											style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px; font-family: monospace;"></textarea>
										<button id="library-reset-prompt-permanent" class="btn btn-secondary"
											style="font-size: 11px; margin-top: 4px;">Reset to
											Default</button>
									</div>
								</details>
							</div>
						</div>
					</div>

					<!-- Advanced Settings Tab -->
					<div class="settings-tab-content hidden" id="advanced-settings">
						<div class="settings-grid">
							<div class="settings-section" data-full-width="true"
								style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
								<h3 style="margin: 0 0 6px 0; font-size: 14px; font-weight: 600; color: #f59e0b;">âš ï¸
									Advanced Area</h3>
								<p class="settings-desc" style="margin: 0; font-size: 11px;">
									These settings are for power users. Change only if you know what you're doing.
								</p>
							</div>



							<!-- SECTION: Analytics & Diagnostics -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #06b6d4;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #06b6d4;">
									ğŸ“Š Analytics & Diagnostics
								</h3>

								<div class="settings-item" style="margin-bottom: 12px;">
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px; cursor: pointer;">
										<input type="checkbox" id="telemetry-toggle" checked />
										<span style="font-weight: 500; font-size: 12px;">Usage data</span>
									</label>
									<p class="settings-desc" style="font-size: 11px;">
										Anonymous only
									</p>
								</div>

								<div class="settings-item">
									<label
										style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px; cursor: pointer;">
										<input type="checkbox" id="send-errors-toggle" checked />
										<span style="font-weight: 500; font-size: 12px;">Error reports</span>
									</label>
									<p class="settings-desc" style="font-size: 11px;">
										Help fix bugs
									</p>
								</div>
							</div>

							<!-- SECTION: Developer Options -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #64748b;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #64748b;">
									âš™ï¸ Developer
								</h3>
								<div class="settings-item" style="margin-bottom: 12px;">
									<div
										style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
										<span style="font-weight: 500; font-size: 12px;">ğŸ§ª Debug Mode</span>
										<label class="toggle-switch toggle-switch-sm">
											<input type="checkbox" id="library-debug-mode" />
											<span class="toggle-slider"></span>
										</label>
									</div>
									<p class="settings-desc" style="margin-top: 6px; font-size: 11px;">
										Enable console logging for debugging extension issues.
									</p>
									<!-- Debug Sub-Options -->
									<div id="debug-sub-options" style="
										margin-top: 12px;
										padding-top: 12px;
										border-top: 1px solid var(--border-color, #475569);
										display: none;
									">
										<!-- Truncate Console Output -->
										<div class="settings-item" style="margin-bottom: 10px;">
											<div
												style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
												<span style="font-weight: 500; font-size: 12px;">ğŸ“ Truncate Console
													Output</span>
												<label class="toggle-switch toggle-switch-sm">
													<input type="checkbox" id="library-debug-truncate" checked />
													<span class="toggle-slider"></span>
												</label>
											</div>
											<p class="settings-desc" style="margin-top: 4px; font-size: 11px;">
												Limits output length to prevent console overflow. Disable for complete
												output.
											</p>
										</div>

										<!-- Truncation Length Setting -->
										<div class="settings-item" style="margin-bottom: 8px;">
											<label for="library-debug-truncate-length" class="settings-desc"
												style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 12px;">
												ğŸ“Œ Max Characters per Log:
											</label>
											<input type="number" id="library-debug-truncate-length" min="100"
												max="10000" value="500" step="100"
												style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 11px;" />
											<p class="settings-desc" style="margin-top: 4px; font-size: 11px;">
												Characters before truncation (100-10000)
											</p>
										</div>
									</div>
								</div>
								<div class="settings-item">
									<label for="webhook-url" class="settings-desc"
										style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 12px;">
										Webhook URL:
									</label>
									<input type="url" id="webhook-url" placeholder="https://..."
										style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 11px;" />
									<p class="settings-desc" style="margin-top: 4px; font-size: 11px;">
										Custom endpoint for errors
									</p>
								</div>
							</div>
							<!-- SECTION: Processing Options -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #38bdf8;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #38bdf8;">
									ğŸ§ª Processing Options
								</h3>
								<div class="settings-item" style="margin-bottom: 12px;">
									<div
										style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
										<span style="font-weight: 500; font-size: 12px;">Split large chapters
											automatically</span>
										<label class="toggle-switch toggle-switch-sm">
											<input type="checkbox" id="library-chunking-enabled" />
											<span class="toggle-slider"></span>
										</label>
									</div>
									<p class="settings-desc" style="margin-top: 6px; font-size: 11px;">
										Processes large chapters in parts to avoid token limits.
									</p>
								</div>
								<div class="settings-item">
									<label for="library-chunk-size"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Segment size (words per chunk):
									</label>
									<input type="number" id="library-chunk-size" min="100" max="10000" step="100"
										value="3200"
										style="width: 140px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
									<p class="settings-desc" style="margin-top: 6px; font-size: 11px;">
										Recommended: 3200 words. Smaller = safer but more segments.
									</p>
								</div>
								<div class="settings-item" style="margin-top: 12px;">
									<label for="library-chunk-summary-count"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Summary buttons every N chunks:
									</label>
									<input type="number" id="library-chunk-summary-count" min="1" max="10" step="1"
										value="2"
										style="width: 140px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
									<p class="settings-desc" style="margin-top: 6px; font-size: 11px;">
										Controls how often summary buttons appear between chunks.
									</p>
								</div>
								<div class="settings-item" style="margin-top: 12px;">
									<label for="library-max-output-tokens"
										style="display: block; font-weight: 500; margin-bottom: 4px; font-size: 12px;">
										Maximum Output Length (tokens):
									</label>
									<input type="number" id="library-max-output-tokens" min="1000" max="32768"
										step="512" value="8192"
										style="width: 160px; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;" />
									<p class="settings-desc" style="margin-top: 6px; font-size: 11px;">
										Controls maximum length of generated text.
									</p>
								</div>
							</div>
							<!-- SECTION: AI Parameters -->
							<div class="settings-section"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #64748b;">
								<h3>ğŸ¯ AI Parameters</h3>

								<!-- Top K slider -->
								<div class="settings-item">
									<label>Top K: <span id="library-top-k-value">40</span></label>
									<input type="range" id="library-top-k-slider" min="1" max="100" step="1" value="40"
										style="width: 100%;" />
									<p class="settings-desc">Limits token selection pool (1-100)</p>
								</div>

								<!-- Top P slider -->
								<div class="settings-item">
									<label>Top P: <span id="library-top-p-value">0.95</span></label>
									<input type="range" id="library-top-p-slider" min="0" max="1" step="0.05"
										value="0.95" style="width: 100%;" />
									<p class="settings-desc">Nucleus sampling (0-1)</p>
								</div>

								<!-- Word Count Threshold slider -->
								<div class="settings-item">
									<label>Word Count Threshold: <span
											id="library-word-count-threshold-value">25</span>%</label>
									<input type="range" id="library-word-count-threshold-slider" min="0" max="100"
										step="1" value="25" style="width: 100%;" />
									<p class="settings-desc">Warning if word change exceeds this percentage (0-100%)</p>
								</div>

								<!-- Model Endpoint URL -->
								<div class="settings-item">
									<label for="library-advanced-model-endpoint">Model Endpoint URL</label>
									<div class="settings-inline">
										<input type="text" id="library-advanced-model-endpoint" readonly
											placeholder="https://..." style="width: 100%; font-size: 11px;" />
										<button id="library-advanced-copy-endpoint" class="btn btn-secondary"
											style="font-size: 11px; padding: 6px 8px;">Copy</button>
									</div>
									<p class="settings-desc">Auto-generated model API endpoint</p>
								</div>
							</div>

							<!-- SECTION: Factory Reset (full width) -->
							<div class="settings-section" data-full-width="true"
								style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.15) 100%); padding: 20px; border-radius: 8px; border: 2px solid #ef4444; border-left: 4px solid #dc2626;">
								<h3
									style="margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: #ef4444; display: flex; align-items: center; gap: 8px;">
									<span style="font-size: 20px;">âš ï¸</span>
									<span>Factory Reset</span>
								</h3>
								<div
									style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 6px; border-left: 3px solid #ef4444; margin-bottom: 16px;">
									<p style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: #fecaca;">
										âš¡ This will permanently delete:
									</p>
									<ul
										style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.8; color: var(--text-secondary, #d1d5db);">
										<li>All novels from your library</li>
										<li>All enhanced chapters and summaries</li>
										<li>Google Drive OAuth credentials</li>
										<li>All local and browser-stored backups</li>
										<li>Theme settings and preferences</li>
									</ul>
									<p style="margin: 8px 0 0 0; font-size: 11px; color: #fca5a5; font-style: italic;">
										ğŸ’¡ This does NOT delete Google Drive cloud backups. You can restore from them
										later.
									</p>
								</div>
								<button id="library-factory-reset-btn" class="btn"
									style="width: 100%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; font-weight: 700; font-size: 13px; padding: 14px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);"
									onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 16px rgba(239, 68, 68, 0.4)'"
									onmouseout="this.style.transform=''; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'">
									ğŸ”¥ Factory Reset - Delete Everything
								</button>
								<p class="settings-desc"
									style="margin-top: 12px; text-align: center; font-size: 10px; color: var(--text-secondary, #9ca3af);">
									âš ï¸ This action cannot be undone. Create a backup first!
								</p>
							</div>
						</div>
					</div>

					<!-- Site Settings Tab -->
					<div class="settings-tab-content hidden" id="site-settings">
						<div class="settings-grid">
							<!-- SECTION 9: Auto-Add by Site (FULL WIDTH) -->
							<div class="settings-section" data-full-width="true"
								style="background: var(--bg-secondary, #1e293b); padding: 16px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
								<h3 style="margin: 0 0 12px 0; font-size: 15px; font-weight: 600; color: #8b5cf6;">
									ğŸŒ Auto-Add by Site
								</h3>
								<p class="settings-desc" style="margin-bottom: 12px; font-size: 12px;">
									Disable a site to hide its enhancements and auto-add rules.
								</p>
								<div id="site-autoadd-list" class="site-autoadd-list"></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Drive Backups Modal -->
			<div id="drive-backups-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
					<button class="modal-close" id="drive-backups-close">&times;</button>
					<h2 style="margin-bottom: 8px;">â˜ï¸ Google Drive Backups</h2>
					<p style="margin: 0 0 24px 0; font-size: 13px; color: var(--text-secondary, #999);">
						View and restore backups from your Google Drive
					</p>
					<div id="drive-backups-loading" style="text-align: center; padding: 40px;">
						<div style="font-size: 48px; margin-bottom: 16px;">â³</div>
						<p>Loading backups from Drive...</p>
					</div>
					<div id="drive-backups-list" class="hidden" style="display: grid; gap: 12px;"></div>
					<div id="drive-backups-empty" class="hidden" style="text-align: center; padding: 40px;">
						<div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
						<p>No backups found on Google Drive</p>
						<p style="font-size: 12px; color: var(--text-secondary, #999); margin-top: 8px;">
							Create backups from the Popup settings
						</p>
					</div>
				</div>
			</div>

			<!-- Telemetry Consent Modal (First Run) -->
			<div id="telemetry-consent-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content modal-small" style="max-width: 480px;">
					<h2>ğŸ“Š Anonymous Usage Analytics</h2>
					<p style="margin: 16px 0; line-height: 1.6;">
						Ranobe Gemini collects anonymous usage statistics to help improve the extension.
						This is <strong>enabled by default</strong> but you can opt out anytime.
					</p>
					<div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px; margin: 16px 0;">
						<h4 style="margin: 0 0 12px 0; font-size: 14px;">What we collect:</h4>
						<ul style="margin: 0; padding-left: 20px; font-size: 13px; line-height: 1.6;">
							<li>Anonymous view counts (via CFlair-Counter)</li>
							<li>Feature usage counts (no content, just counts)</li>
							<li>Error reports (optional, helps fix bugs)</li>
						</ul>
						<h4 style="margin: 16px 0 12px 0; font-size: 14px;">What we NEVER collect:</h4>
						<ul style="margin: 0; padding-left: 20px; font-size: 13px; line-height: 1.6;">
							<li>API keys or credentials</li>
							<li>Novel reading history or library data</li>
							<li>Personal information of any kind</li>
						</ul>
					</div>
					<p style="margin: 16px 0; font-size: 13px; color: var(--text-secondary);">
						You can change this setting anytime in Library Settings â†’ Analytics & Diagnostics.
					</p>
					<div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
						<button id="telemetry-decline-btn" class="btn btn-secondary">
							Opt Out
						</button>
						<button id="telemetry-accept-btn" class="btn btn-primary">
							Keep Enabled
						</button>
					</div>
				</div>
			</div>

			<!-- Notification Panel -->
			<div id="notification-panel" class="notification-panel hidden">
				<div class="notification-panel-backdrop"></div>
				<div class="notification-panel-content">
					<div class="notification-panel-header">
						<h3>ğŸ”” Notifications</h3>
						<button class="notification-panel-close" id="notification-panel-close">
							&times;
						</button>
					</div>
					<div class="notification-panel-body">
						<div class="notification-actions">
							<button id="library-mark-all-read" class="btn btn-secondary">
								âœ“ Mark All Read
							</button>
							<button id="library-clear-all-notifications" class="btn btn-secondary">
								ğŸ—‘ Clear All
							</button>
						</div>
						<div id="library-notification-list" class="notification-list">
							<!-- Notifications will be populated by JavaScript -->
						</div>
					</div>
				</div>
			</div>

			<!-- Browser API polyfill for Chrome/Edge compatibility -->
			<script src="../lib/browser-polyfill.min.js"></script>

			<script type="module" src="library.js"></script>
	</body>

</html>
