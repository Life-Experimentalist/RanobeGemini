<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RanobeGemini</title>
		<link rel="stylesheet" href="popup.css" />
	</head>

	<body>
		<div class="container">
			<div class="header">
				<h1>
					<img src="../icons/logo-48.png" alt="Ranobe Gemini"
						style="width: 48px; height: 48px; margin-right: 8px" />Ranobe Gemini
				</h1>
				<button id="quickLibraryBtn" class="quick-library-btn" title="Open Full Library (Ctrl+Alt+N)">
					<img src="../icons/icon.png" alt="Library" style="width: 48px; height: 48px; margin-right: 8px" />
				</button>
			</div>

			<!-- Tab navigation -->
			<div class="tabs">
				<button class="tab-btn" data-tab="novels">Novels</button>
				<button class="tab-btn active" data-tab="config">Config</button>
				<button class="tab-btn" data-tab="notifications" id="notificationsTabBtn">
					ğŸ””
					<span id="notificationBadge" class="notification-badge" style="display: none">0</span>
				</button>
			</div>

			<!-- Config Tab -->
			<div id="config" class="tab-content active">
				<!-- SECTION: API Keys Management -->
				<div class="config-section">
					<h3 class="config-section-title">ğŸ” API Keys</h3>
					<div class="config-section-content">
						<!-- Primary API Key -->
						<div class="config-item">
							<label for="apiKey">Primary Gemini API Key</label>
							<input type="password" id="apiKey" placeholder="Paste your API key" />
							<div class="config-actions">
								<button id="saveApiKey">ğŸ’¾ Save</button>
								<button id="testApiKey">ğŸ§ª Test</button>
								<a id="getKeyLink" href="#" class="config-link">Get Key</a>
							</div>
							<div id="status" class="status" style="margin-top: 8px; font-size: 11px"></div>
						</div>

						<!-- Backup API Keys -->
						<details open style="margin-top: 12px">
							<summary
								style="cursor: pointer; font-weight: 600; font-size: 13px; color: var(--text-primary)">
								ğŸ”‘ Backup Keys
							</summary>
							<div style="margin-top: 10px">
								<div id="backupKeysList" class="backup-keys-list"
									style="max-height: 150px; overflow-y: auto; margin-bottom: 8px"></div>
								<div style="display: flex; gap: 6px; margin-bottom: 8px">
									<input type="password" id="newBackupKey" placeholder="Add backup key"
										style="flex: 1; font-size: 11px" />
									<button id="addBackupKey" style="font-size: 11px">+ Add</button>
								</div>
								<div>
									<label for="apiKeyRotation" style="font-size: 12px; font-weight: 500">Rotation
										Strategy</label>
									<select id="apiKeyRotation" style="width: 100%; font-size: 11px; margin-top: 4px">
										<option value="off">Off</option>
										<option value="round_robin">Round Robin</option>
										<option value="random">Random</option>
									</select>
									<div class="description" style="font-size: 10px; margin-top: 4px">
										Auto-use backup keys if primary hits rate limits
									</div>
								</div>
							</div>
						</details>
					</div>
				</div>

				<!-- SECTION: Model Selection -->
				<div class="config-section">
					<h3 class="config-section-title">ğŸ¤– Model Settings</h3>
					<div class="config-section-content">
						<div class="config-item">
							<label for="modelSelect">Gemini Model</label>
							<div style="display: flex; gap: 6px">
								<select id="modelSelect" style="flex: 1">
									<option value="gemini-2.0-flash">Gemini 2.0 Flash (Recommended)</option>
									<option value="gemini-2.5-flash">Gemini 2.5 Flash (Faster)</option>
									<option value="gemini-2.5-pro">Gemini 2.5 Pro (Better quality)</option>
								</select>
								<button id="refreshModels" title="Refresh models"
									style="font-size: 16px; padding: 0 6px">â†»</button>
							</div>
							<div class="description" style="margin-top: 4px">Lists models available with your API key
							</div>
						</div>

						<div class="config-item">
							<label for="maxOutputTokens">Max Output Length</label>
							<input type="number" id="maxOutputTokens" min="1000" max="32768" step="512" value="8192"
								style="width: 100%" />
							<div class="description">Maximum tokens in generated content</div>
						</div>

						<div class="config-item">
							<label
								style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal">
								<input type="checkbox" id="useEmoji" />
								<span>Add emotion emojis to dialogue</span>
							</label>
							<div class="description">Enhances emotional expressions in text</div>
						</div>
					</div>
				</div>

				<!-- SECTION: Google Drive Backup -->
				<div class="config-section">
					<h3 class="config-section-title">â˜ï¸ Google Drive Backup</h3>
					<div class="config-section-content">
						<!-- Drive Status Display -->
						<div
							style="padding: 8px; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between;">
							<span style="font-size: 11px; font-weight: 500;">Status:</span>
							<span id="driveStatus" style="font-size: 11px; font-weight: 600;">âš« Disconnected</span>
						</div>
						<!-- Drive Auth Error Display -->
						<div id="driveAuthError"
							style="display: none; padding: 8px; background: #fef3c7; color: #92400e; border-radius: 4px; margin-bottom: 10px; font-size: 11px;">
						</div>

						<!-- Drive OAuth Credentials -->
						<details id="driveOAuthDetails" class="config-item" open>
							<summary
								style="cursor: pointer; font-weight: 600; font-size: 12px; color: var(--text-primary)">
								ğŸ”‘ OAuth Credentials
							</summary>
							<div style="margin-top: 8px; display: flex; flex-direction: column; gap: 8px;">
								<div class="config-item">
									<label for="driveClientId">Client ID</label>
									<input type="text" id="driveClientId" placeholder="Paste OAuth client ID" />
								</div>
								<div class="config-item">
									<label for="driveClientSecret">Client Secret</label>
									<div style="display: flex; gap: 6px; align-items: center;">
										<input type="password" id="driveClientSecret"
											placeholder="Paste OAuth client secret" style="flex: 1;" />
										<button id="toggleClientSecretVisibility"
											style="padding: 6px 8px; font-size: 11px;">ğŸ‘</button>
									</div>
								</div>
								<div class="config-actions">
									<button id="connectDriveBtn" style="flex: 1;">ğŸ”— Connect Drive</button>
									<button id="disconnectDriveBtn" style="flex: 1;">â Disconnect</button>
								</div>
								<a class="config-link open-library-settings" href="#">Drive setup guide (Library
									Settings)</a>
							</div>
						</details>

						<!-- Drive Not Connected Section -->
						<div id="driveNotConnected" style="display: none;">
							<div
								style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #4285f4">
								<p style="margin: 0; font-size: 11px; color: var(--text-secondary); line-height: 1.4">
									ğŸ“ <strong>Setup Required:</strong> Configure OAuth credentials here or in Library
									Settings â†’ Backups
								</p>
							</div>
							<button id="openLibrarySettings" class="open-library-settings"
								style="width: 100%; padding: 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px">
								âš™ï¸ Open Library Settings
							</button>
						</div>

						<!-- Drive Connected Section -->
						<div id="driveConnected" style="display: none;">
							<!-- Backup Mode Selection -->
							<div class="config-item" style="margin-bottom: 12px;">
								<label
									style="font-size: 11px; font-weight: 500; margin-bottom: 6px; display: block;">Backup
									Mode</label>
								<div style="display: flex; flex-direction: column; gap: 6px;">
									<label
										style="display: flex; align-items: center; gap: 6px; font-size: 11px; cursor: pointer;">
										<input type="radio" name="driveBackupMode" value="continuous" />
										<span>ğŸ”„ Continuous (saves every change)</span>
									</label>
									<label
										style="display: flex; align-items: center; gap: 6px; font-size: 11px; cursor: pointer;">
										<input type="radio" name="driveBackupMode" value="scheduled" />
										<span>â° Scheduled (hourly checks)</span>
									</label>
									<label
										style="display: flex; align-items: center; gap: 6px; font-size: 11px; cursor: pointer;">
										<input type="radio" name="driveBackupMode" value="both" />
										<span>âš¡ Both (recommended)</span>
									</label>
									<label
										style="display: flex; align-items: center; gap: 6px; font-size: 11px; cursor: pointer;">
										<input type="radio" name="driveBackupMode" value="manual" />
										<span>âœ‹ Manual only</span>
									</label>
								</div>
							</div>

							<!-- Continuous Backup Check Interval -->
							<div id="continuousBackupCheckContainer" style="display: none; margin-bottom: 12px;">
								<label style="font-size: 11px; font-weight: 500; margin-bottom: 6px; display: block;">
									Check Interval: <span id="continuousCheckIntervalDisplay">2</span> minutes
								</label>
								<input type="range" min="1" max="60" step="1" value="2" class="slider"
									id="continuousBackupCheckInterval" />
								<div class="description">How often to check for changes in continuous mode</div>
							</div>

							<!-- Auto Restore Toggle -->
							<div class="config-item" style="margin-bottom: 12px;">
								<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
									<input type="checkbox" id="driveAutoRestoreEnabled" />
									<span style="font-size: 11px; font-weight: 500;">Auto-restore from Drive on
										startup</span>
								</label>
								<div class="description">Automatically sync library from Drive when extension loads
								</div>
							</div>

							<!-- Action Buttons -->
							<div style="display: flex; gap: 6px; margin-top: 12px;">
								<button id="backupNowBtn"
									style="flex: 1; padding: 6px; background: #34a853; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 500;">
									ğŸ’¾ Backup Now
								</button>
								<button id="driveSyncNowBtn"
									style="flex: 1; padding: 6px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 500;">
									ğŸ” Sync Now
								</button>
							</div>
							<button id="viewBackupsBtn"
								style="width: 100%; padding: 6px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 500; margin-top: 6px;">
								ğŸ“‚ View Drive Backups
							</button>
						</div>
					</div>

					<!-- SECTION: Display & Theme -->
					<div class="config-section">
						<h3 class="config-section-title">ğŸ¨ Display & Theme</h3>
						<div class="config-section-content">
							<div class="config-item">
								<label for="themeMode">Theme Mode</label>
								<select id="themeMode" style="width: 100%">
									<option value="dark">Dark Mode (Default)</option>
									<option value="light">Light Mode</option>
									<option value="auto">Auto (System Preference)</option>
								</select>
							</div>

							<div class="config-item">
								<label for="fontSizeSlider">
									Font Size
									<span class="slider-value" id="fontSizeValue">100%</span>
								</label>
								<input type="range" min="80" max="150" step="5" value="100" class="slider"
									id="fontSizeSlider" />
								<div class="description">Adjusts enhanced content font size</div>
							</div>
						</div>
					</div>

					<!-- SECTION: Site Toggles -->
					<details class="config-section">
						<summary
							style="cursor: pointer; font-weight: 600; font-size: 13px; color: var(--text-primary); display: flex; justify-content: space-between; align-items: center">
							<span>ğŸŒ Site Toggles</span>
							<span style="font-size: 11px; color: var(--text-secondary); font-weight: normal">Toggle
								sites on/off</span>
						</summary>
						<div class="config-section-content" style="margin-top: 10px">
							<div class="description" style="margin-bottom: 10px">
								Turn off a site to hide enhancement buttons and library sections for it.
							</div>
							<div id="siteToggleList" class="site-toggle-list"></div>
						</div>
					</details>

					<!-- Action Buttons -->
					<div style="display: flex; gap: 8px; margin-top: 16px">
						<button id="saveSettings"
							style="flex: 1; padding: 8px; background: #34a853; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500">
							âœ… Save Settings
						</button>
						<button class="open-library-settings"
							style="flex: 1; padding: 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500">
							âš™ï¸ Library Settings
						</button>
					</div>
				</div>
			</div>
			<!-- Novels Tab -->
			<div class="tab-content" id="novels">
				<!-- Quick Filter -->
				<div style="display: flex; gap: 6px; margin-bottom: 12px; overflow-x: auto; padding-bottom: 4px">
					<button class="novel-filter-btn active" data-filter="all" style="white-space: nowrap">All</button>
					<button class="novel-filter-btn" data-filter="reading" style="white-space: nowrap">ğŸ“–
						Reading</button>
					<button class="novel-filter-btn" data-filter="up-to-date" style="white-space: nowrap">âœ¨
						Up-to-Date</button>
					<button class="novel-filter-btn" data-filter="completed" style="white-space: nowrap">âœ…
						Completed</button>
					<button class="novel-filter-btn" data-filter="on-hold" style="white-space: nowrap">â¸ï¸
						Hold</button>
				</div>
				<!-- Currently Reading Section -->
				<section class="novels-section" style="margin-bottom: 16px">
					<h3 style="margin: 0 0 10px 0; font-size: 13px; font-weight: 600; color: var(--text-secondary)">
						ğŸ“– Now Reading
					</h3>
					<div id="currentNovelInfo">
						<div class="current-novel-card"
							style="display: none; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px">
							<div style="display: flex; gap: 10px">
								<div style="font-size: 28px; flex-shrink: 0">ğŸ“•</div>
								<div style="flex: 1; min-width: 0">
									<div style="font-weight: 600; font-size: 12px; color: var(--text-primary); word-break: break-word; margin-bottom: 4px"
										id="current-novel-title"></div>
									<div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 6px"
										id="current-novel-site">
									</div>
									<div>
										<div style="font-size: 9px; color: var(--text-secondary); margin-bottom: 2px">
											Progress</div>
										<div
											style="background: var(--bg-secondary); border-radius: 3px; height: 5px; overflow: hidden">
											<div id="current-novel-progress"
												style="background: linear-gradient(90deg, #3b82f6, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s ease">
											</div>
										</div>
										<div style="font-size: 9px; color: var(--text-secondary); margin-top: 2px"
											id="current-novel-progress-text">0%</div>
									</div>
								</div>
							</div>
						</div>
						<div class="no-current-novel"
							style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 11px; background: var(--bg-secondary); border-radius: 6px">
							<p style="margin: 0 0 4px 0">ğŸ“–</p>
							<p style="margin: 0; font-weight: 500">No novel on this page</p>
							<p style="margin: 4px 0 0 0; font-size: 10px">Visit a supported site to see current
								novel</p>
						</div>
					</div>
				</section>

				<!-- Library Section -->
				<section class="novels-section">
					<div
						style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px">
						<h3 style="margin: 0; font-size: 13px; font-weight: 600">
							ğŸ“š Your Library
							<span
								style="font-size: 11px; background: var(--accent-primary); color: white; padding: 2px 6px; border-radius: 12px; margin-left: 6px">
								<span id="novelCountBadge">0</span>
							</span>
						</h3>
						<button id="refreshNovels" title="Refresh"
							style="background: transparent; border: 1px solid var(--border-color); color: var(--text-primary); padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 12px">â†»</button>
					</div>
					<!-- View Toggle -->
					<div style="display: flex; gap: 4px; margin-bottom: 10px">
						<button class="novel-view-btn active" data-view="list" style="flex: 1; font-size: 11px">ğŸ“‹
							List</button>
						<button class="novel-view-btn" data-view="grid" style="flex: 1; font-size: 11px">â¬œ
							Grid</button>
					</div>

					<!-- Novels Container -->
					<div id="novelsList" class="novels-list"
						style="display: grid; grid-template-columns: 1fr; gap: 8px; max-height: 400px; overflow-y: auto">
						<div
							style="text-align: center; padding: 24px; color: var(--text-secondary); font-size: 11px; grid-column: 1/-1">
							<p style="margin: 0; font-size: 20px">ğŸ“š</p>
							<p style="margin: 8px 0 0 0; font-weight: 500">No novels yet</p>
							<p style="margin: 4px 0 0 0; font-size: 10px">Open full library to add novels</p>
						</div>
					</div>
				</section>

				<!-- Open Full Library Link -->
				<div style="margin-top: 16px">
					<a href="#" id="openMainLibrary"
						style="display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s">
						<div style="display: flex; align-items: center; gap: 10px">
							<span style="font-size: 18px">ğŸ›ï¸</span>
							<div>
								<strong style="display: block; font-size: 12px">Open Full Library</strong>
								<span style="font-size: 10px; color: var(--text-secondary)">Manage all novels &
									settings</span>
							</div>
						</div>
						<span style="color: var(--text-secondary)">â†’</span>
					</a>
				</div>
			</div>

			<!-- Notifications Tab -->
			<div class="tab-content" id="notifications">
				<div class="notifications-tab-header">
					<div class="notifications-stats">
						<span id="totalNotifs">0</span> total
						<span class="notif-stat-sep">Â·</span>
						<span id="unreadNotifs" class="notif-unread-count">0</span> unread
					</div>
					<div class="notifications-tab-actions">
						<button id="markAllReadBtn" class="notif-action-btn">âœ“ Read All</button>
						<button id="clearNotificationsBtn" class="notif-action-btn notif-action-danger">ğŸ—‘
							Clear</button>
					</div>
				</div>
				<div class="notifications-filter-bar">
					<button class="notification-filter-btn active" data-filter="all">All</button>
					<button class="notification-filter-btn" data-filter="success">Success</button>
					<button class="notification-filter-btn" data-filter="error">Errors</button>
					<button class="notification-filter-btn" data-filter="info">Info</button>
				</div>
				<div id="notificationsContainer" class="notifications-list">
					<div class="no-notifications">
						<p style="font-size: 36px; margin-bottom: 8px">ğŸ“­</p>
						<p>No notifications yet</p>
						<p class="description">Notifications will appear here as you use the extension</p>
					</div>
				</div>
			</div>

			<!-- Size indicator -->
			<div class="size-indicator" id="sizeIndicator"></div>

			<!-- * NOTICE: DO NOT TOUCH THIS BELOW DIV (FROM EXPERIENCE)!!! -->
			<!-- Resize handle with improved visibility -->
			<div class="resize-handle" id="resize-handle" title="Drag to resize"></div>
		</div>
		<!-- Browser API polyfill for Chrome/Edge compatibility -->
		<script src="../lib/browser-polyfill.min.js"></script>
		<script src="popup.js" type="module"></script>
	</body>

</html>
