<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RanobeGemini</title>
		<link rel="stylesheet" href="popup.css"/>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<img
					src="../icons/logo-light-32.png"
					alt="Ranobe Gemini"
					class="light-mode-icon"
				/>
				<img
					src="../icons/logo-dark-32.png"
					alt="Ranobe Gemini"
					class="dark-mode-icon"
				/>
				<h1>Ranobe Gemini</h1>
			</div>

			<!-- Tab navigation -->
			<div class="tabs">
				<button class="tab-btn active" data-tab="settings">
					Settings
				</button>
				<button class="tab-btn" data-tab="novels">Novels</button>
				<button class="tab-btn" data-tab="prompts">Prompts</button>
				<button class="tab-btn" data-tab="advanced">Advanced</button>
				<button class="tab-btn" data-tab="info">Info & FAQ</button>
			</div>

			<!-- Settings Tab -->
			<div id="settings" class="tab-content active">
				<div class="setting">
					<label for="apiKey">Gemini API Key:</label>
					<input
						type="password"
						id="apiKey"
						placeholder="Enter your API key"
					/>
					<div class="button-group">
						<button id="saveApiKey">Save Key</button>
						<button id="testApiKey">Test Key</button>
					</div>
				</div>

				<div class="setting">
					<label for="modelSelect">Gemini Model:</label>
					<div class="model-select-container">
						<select id="modelSelect">
							<option value="gemini-2.0-flash">
								Gemini 2.0 Flash (Recommended)
							</option>
							<option value="gemini-2.5-flash">
								Gemini 2.5 Flash (Faster)
							</option>
							<option value="gemini-2.5-pro">
								Gemini 2.5 Pro (Better quality)
							</option>
						</select>
						<button
							id="refreshModels"
							class="icon-button"
							title="Refresh models list"
						>
							â†»
						</button>
					</div>
				</div>

				<!-- Temperature moved to Advanced tab -->

				<div class="setting">
					<label>Processing Options:</label>
					<div style="margin-top: 8px">
						<label style="font-weight: normal">
							<input
								type="checkbox"
								id="chunkingEnabled"
								checked
							/>
							Split large chapters automatically
						</label>
						<div class="description">
							Processes large chapters in parts to avoid token
							limits
						</div>
					</div>

					<div
						id="chunkSizeContainer"
						style="margin-top: 8px; margin-left: 22px"
					>
						<label for="chunkSize"
							>Segment size (characters per chunk):</label
						>
						<div
							style="
								display: flex;
								gap: 10px;
								align-items: center;
							"
						>
							<input
								type="number"
								id="chunkSize"
								min="5000"
								max="50000"
								step="1000"
								style="width: 120px"
								value="12000"
							/>
							<span
								class="description"
								style="font-size: 12px; color: #666"
							>
								(smaller = safer but more segments)
							</span>
						</div>
					</div>

					<div style="margin-top: 15px">
						<label style="font-weight: normal">
							<input type="checkbox" id="useEmoji" />
							Add emotion emojis to dialogue
						</label>
						<div class="description">
							Adds appropriate emojis to enhance emotional
							expressions in text
						</div>
					</div>
				</div>

				<div class="setting">
					<label for="maxOutputTokens"
						>Maximum Output Length (tokens):</label
					>
					<input
						type="number"
						id="maxOutputTokens"
						min="1000"
						max="32768"
						step="512"
						value="8192"
					/>
					<div class="description">
						Controls maximum length of generated text (higher =
						longer outputs)
					</div>
				</div>

				<div class="setting">
					<label>
						<input type="checkbox" id="debugMode" />
						Debug mode (console logging)
					</label>
				</div>

				<div class="actions">
					<button id="enhancePageBtn">Enhance Current Page</button>
					<button
						id="saveSettings"
						style="float: right; background-color: #34a853"
					>
						Save All Settings
					</button>
				</div>
			</div>

			<!-- Novels Tab -->
			<div id="novels" class="tab-content">
				<div class="tab-header">
					<h3>Novels</h3>
					<button id="refreshNovels" class="icon-button">
						â†» Refresh
					</button>
				</div>
				<div class="novels-list" id="novelsList">
					<div class="no-novels">
						No novels found. Use refresh or future add feature.
					</div>
				</div>
			</div>

			<!-- Prompts Tab -->
			<div id="prompts" class="tab-content">
				<div class="setting">
					<label for="promptTemplate">Enhancement Prompt:</label>
					<textarea
						id="promptTemplate"
						placeholder="Instructions for Gemini AI..."
					></textarea>
					<button id="resetPrompt" style="margin-top: 5px">
						Reset to Default
					</button>
				</div>

				<div class="setting">
					<label for="summaryPrompt">Summary Prompt:</label>
					<textarea
						id="summaryPrompt"
						placeholder="Instructions for summarization..."
					></textarea>
					<button id="resetSummaryPrompt" style="margin-top: 5px">
						Reset to Default
					</button>
				</div>

				<div class="setting">
					<label for="siteSpecificPrompts"
						>Site-Specific Prompts:</label
					>
					<div
						id="siteSpecificPromptsContainer"
						class="site-specific-prompts"
					>
						<!-- Site-specific prompts will be loaded dynamically -->
						<div class="no-site-prompts" id="noSitePrompts">
							No site-specific prompts available.
						</div>
					</div>
					<div class="site-prompt-template" style="display: none">
						<div class="site-prompt-item">
							<div class="site-prompt-header">
								<input
									type="text"
									class="site-name"
									placeholder="Site name"
								/>
								<button class="remove-site-prompt">âœ•</button>
							</div>
							<textarea
								class="site-prompt-content"
								rows="3"
								placeholder="Enter site-specific prompt"
							></textarea>
						</div>
					</div>
					<button id="addSitePrompt" style="margin-top: 5px">
						Add Site Prompt
					</button>
					<div class="description">
						These prompts are automatically provided by website
						handlers and can be customized. They help Gemini
						understand the specific formatting and style of each
						site.
					</div>
				</div>

				<div class="setting">
					<label for="permanentPrompt"
						>Permanent Prompt (Appended to all requests):</label
					>
					<textarea id="permanentPrompt" rows="4"></textarea>
					<button id="resetPermanentPrompt" style="margin-top: 5px">
						Reset to Default
					</button>
				</div>

				<div class="actions">
					<button
						id="resetAllPrompts"
						style="background-color: #db4437"
					>
						Reset All Prompts
					</button>
					<button
						id="savePrompts"
						style="float: right; background-color: #34a853"
					>
						Save Prompts
					</button>
				</div>
			</div>

			<!-- Advanced Tab -->
			<div id="advanced" class="tab-content">
				<div class="setting">
					<div class="slider-block">
						<label for="temperatureSlider">
							Temperature
							<span class="slider-value" id="temperatureValue"
								>0.7</span
							>
						</label>
						<input
							type="range"
							min="0"
							max="1"
							step="0.1"
							value="0.7"
							class="slider"
							id="temperatureSlider"
						/>
						<div class="description">
							Controls creativity (0 = deterministic, 1 =
							creative)
						</div>
					</div>

					<div class="slider-block">
						<label for="topPSlider">
							Top-P
							<span class="slider-value" id="topPValue"
								>0.95</span
							>
						</label>
						<input
							type="range"
							min="0"
							max="1"
							step="0.05"
							value="0.95"
							class="slider"
							id="topPSlider"
						/>
						<div class="description">
							Controls diversity of output (lower = more focused)
						</div>
					</div>

					<div class="slider-block">
						<label for="topKSlider">
							Top-K
							<span class="slider-value" id="topKValue">40</span>
						</label>
						<input
							type="range"
							min="1"
							max="100"
							step="1"
							value="40"
							class="slider"
							id="topKSlider"
						/>
						<div class="description">
							Limits token selection pool (lower = more
							deterministic)
						</div>
					</div>
				</div>

				<div class="setting">
					<label for="maxOutputTokens"
						>Maximum Output Length (tokens):</label
					>
					<input
						type="number"
						id="maxOutputTokens"
						min="1000"
						max="32768"
						step="512"
						value="8192"
					/>
					<div class="description">
						Controls maximum length of generated text (higher =
						longer outputs)
					</div>
				</div>

				<div class="setting">
					<label for="customEndpoint"
						>Custom Model Endpoint (Advanced):</label
					>
					<input
						type="text"
						id="customEndpoint"
						placeholder="https://generativelanguage.googleapis.com/v1beta/models/..."
					/>
					<div class="description">
						For advanced users only. Leave blank to use standard
						endpoints.
					</div>
				</div>

				<div class="actions">
					<button
						id="resetAllAdvanced"
						style="background-color: #db4437"
					>
						Reset All Advanced Settings
					</button>
					<button
						id="saveAdvancedSettings"
						style="float: right; background-color: #34a853"
					>
						Save Advanced Settings
					</button>
				</div>
			</div>

			<!-- About Tab -->
			<!-- Info & FAQ Tab -->
			<div id="info" class="tab-content">
				<div class="info-header">
					<h3>ğŸ“š Ranobe Gemini</h3>
					<p class="version-badge">Version 2.7.1</p>
				</div>

				<div class="about-section">
					<h4>âœ¨ Overview</h4>
					<p>
						Ranobe Gemini is a powerful browser extension that leverages Google's
						Gemini AI to enhance web novel reading experiences. It improves
						machine-translated content, making it more readable and natural while
						preserving the original story and author's intent.
					</p>
					<p>
						The extension seamlessly integrates with supported novel websites,
						providing instant enhancement, summarization, and intelligent content
						caching for offline access.
					</p>
				</div>

				<div class="about-section">
					<h4>ğŸš€ Key Features</h4>
					<ul class="feature-list">
						<li>
							<strong>Smart Enhancement:</strong> Improves grammar, flow, and
							readability while preserving character voices and story elements
						</li>
						<li>
							<strong>Content Caching:</strong> Automatically caches enhanced
							chapters for 7 days with regenerate and delete options
						</li>
						<li>
							<strong>Chapter Summarization:</strong> Generate concise summaries
							focusing on key plot points and character development
						</li>
						<li>
							<strong>Multi-Site Support:</strong> Works with Ranobes.net,
							FanFiction.net, and Archive of Our Own (AO3)
						</li>
						<li>
							<strong>Customizable Prompts:</strong> Fine-tune enhancement and
							summarization behavior with custom prompts
						</li>
						<li>
							<strong>Advanced AI Parameters:</strong> Control temperature,
							top-P, top-K, and output length for precise results
						</li>
						<li>
							<strong>Large Chapter Handling:</strong> Automatically splits
							and processes lengthy chapters to avoid token limits
						</li>
						<li>
							<strong>Multiple Models:</strong> Choose from Gemini 2.0 Flash,
							2.5 Flash, or 2.5 Pro based on your needs
						</li>
					</ul>
				</div>

				<div class="about-section">
					<h4>ğŸ¯ Getting Started</h4>
					<ol class="setup-steps">
						<li>
							<a href="#" id="getKeyLink" class="inline-link">
								Get a free Gemini API key
							</a> from Google AI Studio
						</li>
						<li>Enter your API key in the <strong>Settings</strong> tab</li>
						<li>Navigate to any chapter on a supported website</li>
						<li>Click <strong>âœ¨ Enhance with Gemini</strong> to improve the text</li>
						<li>Use <strong>ğŸ“ Summarize Chapter</strong> for quick summaries</li>
						<li>Toggle between original and enhanced content anytime</li>
					</ol>
				</div>

				<div class="about-section">
					<h4>ğŸŒ Supported Websites</h4>
					<div class="supported-sites">
						<span class="site-badge">Ranobes.net</span>
						<span class="site-badge">FanFiction.net</span>
						<span class="site-badge">Archive of Our Own</span>
					</div>
				</div>

				<div class="about-section">
					<h4>ğŸ”’ Privacy & Security</h4>
					<p>
						Your privacy is our priority. Ranobe Gemini:
					</p>
					<ul>
						<li>Only sends chapter content to Google's Gemini API for processing</li>
						<li>Stores API keys and settings locally in your browser</li>
						<li>Never collects usage data or personal information</li>
						<li>Operates entirely client-side with no external servers</li>
					</ul>
				</div>

				<div class="about-section">
					<h4>ğŸ“ License</h4>
					<p>
						Ranobe Gemini is open-source software licensed under the
						<strong>Apache License 2.0</strong>. You are free to use, modify,
						and distribute this software under the terms of the license.
					</p>
					<p class="license-links">
						<a href="https://github.com/Life-Experimentalist/RanobeGemini"
						   target="_blank" class="inline-link">
							ğŸ“‚ View Source Code
						</a> â€¢
						<a href="https://github.com/Life-Experimentalist/RanobeGemini/blob/main/LICENSE.md"
						   target="_blank" class="inline-link">
							ğŸ“„ Full License Text
						</a>
					</p>
				</div>

				<div class="about-section">
					<h4>ğŸ’¬ Support & Community</h4>
					<p>
						Need help or want to contribute?
					</p>
					<div class="support-links">
						<a href="https://github.com/Life-Experimentalist/RanobeGemini/issues"
						   target="_blank" class="support-button">
							ğŸ› Report Issues
						</a>
						<a href="https://github.com/Life-Experimentalist/RanobeGemini/discussions"
						   target="_blank" class="support-button">
							ğŸ’­ Discussions
						</a>
						<a href="https://github.com/Life-Experimentalist/RanobeGemini"
						   target="_blank" class="support-button">
							â­ Star on GitHub
						</a>
					</div>
				</div>

				<div class="about-section credits">
					<p>
						Developed with â¤ï¸ by
						<a href="https://github.com/Life-Experimentalist"
						   target="_blank" class="inline-link">
							Life-Experimentalist
						</a>
					</p>
					<p>
						Powered by
						<a href="https://ai.google.dev/" target="_blank" class="inline-link">
							Google Gemini API
						</a>
					</p>
				</div>

				<!-- Divider -->
				<hr style="margin: 40px 0; border: none; border-top: 2px solid #e9ecef;" />

				<h3>â“ Frequently Asked Questions</h3>

				<div class="faq-item">
					<div class="faq-question">ğŸ’¡ What is Ranobe Gemini?</div>
					<div class="faq-answer">
						Ranobe Gemini is a browser extension that uses Google's Gemini AI
						to enhance machine-translated web novels, improving readability,
						grammar, and flow while maintaining the original story integrity.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ”‘ Do I need an API key?</div>
					<div class="faq-answer">
						Yes, you need a free Gemini API key from
						<a href="#" id="faqGetKeyLink" class="inline-link">Google AI Studio</a>.
						The free tier is generous and suitable for most users.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸŒ Which websites are supported?</div>
					<div class="faq-answer">
						Currently supports:
						<ul>
							<li><strong>Ranobes.net</strong> (ranobes.net, ranobes.com, ranobes.top)</li>
							<li><strong>FanFiction.net</strong> (fanfiction.net, m.fanfiction.net)</li>
							<li><strong>Archive of Our Own</strong> (archiveofourown.org, ao3.org)</li>
						</ul>
						More sites may be added based on user requests.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ’¾ How does content caching work?</div>
					<div class="faq-answer">
						Enhanced chapters are automatically cached for 7 days. When you revisit
						a chapter, the cached version loads instantly. You can regenerate fresh
						content or delete the cache using the buttons in the enhanced banner.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">âš™ï¸ Which Gemini model should I use?</div>
					<div class="faq-answer">
						<ul>
							<li><strong>Gemini 2.0 Flash:</strong> Recommended for most users -
							balanced speed and quality</li>
							<li><strong>Gemini 2.5 Flash:</strong> Faster processing, good for
							quick reads</li>
							<li><strong>Gemini 2.5 Pro:</strong> Best quality, larger context
							window, slower processing</li>
						</ul>
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ¨ What do the advanced parameters do?</div>
					<div class="faq-answer">
						<ul>
							<li><strong>Temperature (0.0-1.0):</strong> Controls creativity.
							Lower = consistent, Higher = creative</li>
							<li><strong>Top-P (0.0-1.0):</strong> Nucleus sampling - limits
							token diversity</li>
							<li><strong>Top-K (1-40):</strong> Maximum tokens considered per
							step</li>
							<li><strong>Max Output (1024-8192):</strong> Maximum response length
							in tokens</li>
						</ul>
						Use defaults unless you understand these parameters.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ”§ What if enhancement fails?</div>
					<div class="faq-answer">
						Try these solutions:
						<ol>
							<li>Verify your API key in Settings â†’ Test Key</li>
							<li>Check you're on a supported website</li>
							<li>Enable "Split large chapters automatically" for long content</li>
							<li>Try a different Gemini model</li>
							<li>Lower temperature to 0.3 for more reliable output</li>
							<li>Check browser console (F12) for detailed errors</li>
							<li>Report persistent issues on GitHub</li>
						</ol>
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ“‹ What are Custom Prompts?</div>
					<div class="faq-answer">
						Custom prompts let you control how Gemini processes content:
						<ul>
							<li><strong>Enhancement Prompt:</strong> Instructions for improving
							translation quality</li>
							<li><strong>Summarization Prompt:</strong> Instructions for creating
							chapter summaries</li>
							<li><strong>Permanent Prompt:</strong> Global instructions added to
							all requests</li>
						</ul>
						Reset to defaults if you're unsure about changes.
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ”„ How do I toggle between original and enhanced?</div>
					<div class="faq-answer">
						After enhancement, a banner appears at the top with:
						<ul>
							<li><strong>Show Original</strong> button - switches to original text</li>
							<li><strong>Show Enhanced</strong> button - returns to enhanced version</li>
							<li><strong>ğŸ—‘ï¸ Delete</strong> button - removes cached content (for
							cached chapters)</li>
						</ul>
					</div>
				</div>

				<div class="faq-item">
					<div class="faq-question">ğŸ’° Is this free to use?</div>
					<div class="faq-answer">
						Yes! The extension is free and open-source. You only need a free Gemini
						API key from Google. The free tier includes generous usage limits suitable
						for regular novel reading. Check Google AI Studio for current rate limits.
					</div>
				</div>
			</div>

			<div id="status"></div>

			<!-- Size indicator -->
			<div class="size-indicator" id="sizeIndicator"></div>

			<!-- * NOTICE: DO NOT TOUCH THIS BELOW DIV (FROM EXPERIENCE)!!! -->
			<!-- Resize handle with improved visibility -->
			<div
				class="resize-handle"
				id="resize-handle"
				title="Drag to resize"
			></div>
		</div>
		<script src="popup.js" type="module"></script>
	</body>
</html>
