<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RanobeGemini</title>
		<link rel="stylesheet" href="popup.css" />
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>
					<img
						src="../icons/logo-48.png"
						alt="Ranobe Gemini"
						style="width: 48px; height: 48px; margin-right: 8px"
					/>Ranobe Gemini
				</h1>
				<button
					id="quickLibraryBtn"
					class="quick-library-btn"
					title="Open Full Library (Ctrl+Alt+N)"
				>
					<img
						src="../icons/icon.png"
						alt="Library"
						style="width: 48px; height: 48px; margin-right: 8px"
					/>
				</button>
			</div>

			<!-- Tab navigation -->
			<div class="tabs">
				<button class="tab-btn active" data-tab="config">Config</button>
				<button class="tab-btn" data-tab="novels">Novels</button>
				<button
					class="tab-icon-btn"
					id="notificationsToggle"
					title="Notifications"
				>
					<span class="tab-icon">??</span>
					<span
						id="notificationBadge"
						class="notification-badge"
						style="display: none"
						>0</span
					>
				</button>
			</div>

			<!-- Config Tab -->
			<div id="config" class="tab-content active">
				<div class="setting">
					<label for="apiKey">Gemini API Key:</label>
					<input
						type="password"
						id="apiKey"
						placeholder="Enter your API key"
					/>
					<div
						class="api-key-actions"
						style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px"
					>
						<button id="saveApiKey">Save Key</button>
						<button id="testApiKey">Test Key</button>
						<a id="getKeyLink" href="#" style="align-self: center"
							>Get API Key</a
						>
					</div>
					<div id="status" class="status" style="margin-top: 8px"></div>
				</div>

				<div class="setting">
					<label for="modelSelect">Gemini Model:</label>
					<div class="model-select-container">
						<select id="modelSelect">
							<option value="gemini-2.0-flash">
								Gemini 2.0 Flash (Recommended)
							</option>
							<option value="gemini-2.5-flash">
								Gemini 2.5 Flash (Faster)
							</option>
							<option value="gemini-2.5-pro">
								Gemini 2.5 Pro (Better quality)
							</option>
						</select>
						<button
							id="refreshModels"
							class="icon-button"
							title="Refresh models list"
						>
							?
						</button>
					</div>
					<div
						style="display: flex; gap: 8px; margin-top: 8px; align-items: center"
					>
						<input
							id="modelEndpointDisplay"
							type="text"
							readonly
							style="flex: 1; min-width: 0"
						/>
						<button
							id="copyModelEndpoint"
							class="icon-button"
							title="Copy model endpoint"
						>
							??
						</button>
					</div>
				</div>

				<div class="setting">
					<label>?? Processing Options</label>
					<div class="description" style="margin-top: 6px">
						Moved to Library Settings for better control.
					</div>
				</div>

				<div
					class="setting"
					style="
						margin-top: 15px;
						padding: 10px;
						border: 1px solid var(--border-color);
						border-radius: 6px;
						background: var(--accent-primary) 20;
					"
				>
					<label
						style="
							font-weight: normal;
							display: flex;
							align-items: center;
							gap: 8px;
							cursor: pointer;
						"
					>
						<input
							type="checkbox"
							id="useEmoji"
							style="cursor: pointer"
						/>
						<span>Add emotion emojis to dialogue</span>
					</label>
					<div class="description" style="margin-top: 6px">
						Adds appropriate emojis to enhance emotional expressions in text
					</div>
				</div>

				<div class="setting">
					<label for="maxOutputTokens"
						>Maximum Output Length (tokens):</label
					>
					<input
						type="number"
						id="maxOutputTokens"
						min="1000"
						max="32768"
						step="512"
						value="8192"
					/>
					<div class="description">
						Controls maximum length of generated text (higher = longer outputs)
					</div>
				</div>

				<details class="setting backup-keys-section" open>
					<summary>?? Alternate API Keys</summary>
					<div class="backup-keys-content">
						<div id="backupKeysList" class="backup-keys-list"></div>
						<div class="add-backup-key">
							<input
								type="text"
								id="newBackupKey"
								placeholder="Add another API key"
							/>
							<button id="addBackupKey">Add Key</button>
						</div>
						<div style="margin-top: 10px">
							<label for="apiKeyRotation">Key Rotation</label>
							<select
								id="apiKeyRotation"
								style="width: 100%; margin-top: 6px"
							>
								<option value="off">Off</option>
								<option value="round_robin">Round Robin</option>
								<option value="random">Random</option>
							</select>
							<div class="description" style="margin-top: 6px">
								Use alternate keys automatically if one hits limits.
							</div>
						</div>
					</div>
				</details>

				<!-- Theme Mode Quick Toggle -->
				<div class="setting">
					<label for="themeMode">?? Theme Mode</label>
					<select
						id="themeMode"
						style="width: 100%; padding: 10px; border-radius: 6px"
					>
						<option value="dark">Dark Mode (Default)</option>
						<option value="light">Light Mode</option>
						<option value="auto">Auto (System Preference)</option>
					</select>
				</div>

				<!-- Site Toggles -->
				<details class="setting">
					<summary style="cursor: pointer; font-weight: 600">
						?? Site Toggles
					</summary>
					<div style="margin-top: 12px">
						<div class="description" style="margin-bottom: 12px">
							Turn off a site to hide enhance buttons and library shelves for it.
						</div>
						<div id="siteToggleList" class="site-toggle-list"></div>
					</div>
				</details>

				<!-- Font Size -->
				<div class="setting">
					<div class="slider-block">
						<label for="fontSizeSlider">
							?? Enhanced Content Font Size
							<span class="slider-value" id="fontSizeValue">100%</span>
						</label>
						<input
							type="range"
							min="80"
							max="150"
							step="5"
							value="100"
							class="slider"
							id="fontSizeSlider"
						/>
						<div class="description">
							Adjusts font size of enhanced content (100% = default)
						</div>
					</div>
				</div>

				<div class="setting" style="display: flex; gap: 8px; flex-wrap: wrap">
					<button id="saveSettings">Save Settings</button>
					<button
						class="open-library-settings"
						style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
					>
						?? Library Settings
					</button>
				</div>

				<!-- Advanced Settings Link -->
				<details class="setting">
					<summary style="cursor: pointer; font-weight: 600">
						?? More Settings
					</summary>
					<div style="margin-top: 12px">
						<div
							style="
								background: var(--bg-tertiary, rgba(255, 255, 255, 0.05));
								padding: 12px;
								border-radius: 8px;
								border-left: 3px solid #4285f4;
							"
						>
							<p
								style="
									margin: 0 0 8px 0;
									font-size: 12px;
									color: var(--text-secondary);
								"
							>
								?? Advanced settings (debug mode, custom prompts, AI parameters), backups, and Google Drive sync are in Library Settings.
							</p>
							<button
								class="open-library-settings"
								style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;"
							>
								?? Library Settings
							</button>
						</div>
					</div>
				</details>
			</div>

			<!-- Novels Tab -->
			<div class="tab-content" id="novels">
				<h3
					style="
						margin-bottom: 16px;
						font-size: 16px;
						font-weight: 600;
						display: flex;
						align-items: center;
						justify-content: space-between;
					"
				>
					<span>?? Your Reading</span>
					<button
						class="icon-button open-library-settings"
						title="Open Library Settings"
						style="font-size: 16px"
					>
						??
					</button>
				</h3>

				<!-- Current Novel Section -->
				<div class="current-novel-section">
					<div id="currentNovelInfo" class="current-novel-card">
						<div class="no-current-novel">
							<p>No novel detected on this page.</p>
							<p class="description">
								Visit a supported novel site to get started!
							</p>
						</div>
					</div>
				</div>

				<!-- Suggested Novels Section -->
				<div class="suggested-novels-section">
					<div
						class="section-header"
						style="
							display: flex;
							justify-content: space-between;
							align-items: center;
						"
					>
						<span>? Suggested Reads</span>
						<button
							id="randomizeSuggestions"
							class="icon-button"
							title="Randomize suggestions"
							style="
								background: none;
								border: none;
								font-size: 18px;
								cursor: pointer;
								padding: 4px 8px;
							"
						>
							??
						</button>
					</div>
					<div
						id="suggestedNovelsList"
						class="suggested-novels-container"
					>
						<div class="no-suggestions">
							<p>
								No suggestions yet. Add novels to your library!
							</p>
						</div>
					</div>
				</div>

				<!-- All Novels Section -->
				<div class="all-novels-section">
					<div class="section-header">
						?? Your Library
						<button
							id="refreshNovels"
							class="icon-button"
							title="Refresh library"
						>
							?
						</button>
					</div>
					<div class="novels-list" id="novelsList">
						<div class="no-novels">
							No novels in your library yet.
						</div>
					</div>
				</div>

				<!-- Quick Navigation -->
				<!-- Main Library -->
				<a
					href="#"
					id="openMainLibrary"
					class="main-library-link"
					style="
						display: flex;
						align-items: center;
						gap: 12px;
						padding: 14px;
						background: linear-gradient(
							135deg,
							#667eea 0%,
							#764ba2 100%
						);
						border-radius: 8px;
						text-decoration: none;
						color: white;
						transition: transform 0.2s;
					"
				>
					<span style="font-size: 24px">???</span>
					<div style="flex: 1">
						<div style="font-weight: 600; font-size: 14px">
							Main Library
						</div>
						<div style="font-size: 11px; opacity: 0.9">
							View all your saved novels
						</div>
					</div>
					<span style="font-size: 18px">?</span>
				</a>
			</div>

			<!-- Prompts & Advanced settings moved to Library Settings -->

			<!-- Notifications Modal (triggered by bell icon) -->
			<div
				id="notificationsModal"
				style="
					display: none;
					position: absolute;
					inset: 0;
					background: rgba(0, 0, 0, 0.6);
					z-index: 1000;
					border-radius: 8px;
					overflow-y: auto;
				"
			>
				<div
					style="
						position: absolute;
						top: 50%;
						left: 50%;
						transform: translate(-50%, -50%);
						background: var(--bg-primary, #0f172a);
						border: 1px solid var(--border-color, #334155);
						border-radius: 12px;
						padding: 20px;
						width: 85%;
						max-width: 450px;
						max-height: 500px;
						overflow-y: auto;
						box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
					"
				>
					<div
						style="
							display: flex;
							justify-content: space-between;
							align-items: center;
							margin-bottom: 16px;
						"
					>
						<h2
							style="margin: 0; font-size: 18px; font-weight: 600"
						>
							?? Notifications
						</h2>
						<button
							id="closeNotificationsModal"
							style="
								background: none;
								border: none;
								font-size: 20px;
								cursor: pointer;
								color: var(--text-secondary, #999);
							"
						>
							?
						</button>
					</div>
					<div
						id="notificationsContainer"
						style="display: grid; gap: 8px"
					>
						<div
							style="
								text-align: center;
								padding: 40px 20px;
								color: var(--text-secondary, #999);
							"
						>
							<p>?? No notifications yet</p>
							<p style="font-size: 12px">
								Notifications will appear here as you use the
								extension
							</p>
						</div>
					</div>
					<div style="margin-top: 16px; display: flex; gap: 8px">
						<button
							id="markAllReadBtn"
							style="
								flex: 1;
								padding: 8px;
								background: var(--accent-secondary, #475569);
								border: none;
								border-radius: 6px;
								color: white;
								cursor: pointer;
								font-size: 12px;
							"
						>
							Mark All Read
						</button>
						<button
							id="clearNotificationsBtn"
							style="
								flex: 1;
								padding: 8px;
								background: #db4437;
								border: none;
								border-radius: 6px;
								color: white;
								cursor: pointer;
								font-size: 12px;
							"
						>
							Clear All
						</button>
					</div>
				</div>
			</div>

			<!-- Size indicator -->
			<div class="size-indicator" id="sizeIndicator"></div>

			<!-- * NOTICE: DO NOT TOUCH THIS BELOW DIV (FROM EXPERIENCE)!!! -->
			<!-- Resize handle with improved visibility -->
			<div
				class="resize-handle"
				id="resize-handle"
				title="Drag to resize"
			></div>
		</div>
		<!-- Browser API polyfill for Chrome/Edge compatibility -->
		<script src="../lib/browser-polyfill.min.js"></script>
		<script src="popup.js" type="module"></script>
	</body>
</html>
